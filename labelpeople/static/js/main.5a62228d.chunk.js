(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{141:function(e,t,a){e.exports=a(273)},146:function(e,t,a){},147:function(e,t,a){},148:function(e,t,a){},178:function(e,t,a){},179:function(e,t,a){},180:function(e,t,a){},181:function(e,t,a){},182:function(e,t,a){},183:function(e,t,a){},184:function(e,t,a){},185:function(e,t,a){},186:function(e,t,a){},187:function(e,t,a){},188:function(e,t,a){},189:function(e,t,a){},190:function(e,t,a){},191:function(e,t,a){},192:function(e,t,a){},193:function(e,t,a){},194:function(e,t,a){},195:function(e,t,a){},196:function(e,t,a){},197:function(e,t,a){},199:function(e,t,a){},200:function(e,t,a){},205:function(e,t,a){e.exports=a.p+"static/media/dir.867ab584.svg"},225:function(e,t,a){},226:function(e,t,a){},227:function(e,t,a){},232:function(e,t){},234:function(e,t){},267:function(e,t,a){},268:function(e,t,a){},269:function(e,t,a){},270:function(e,t,a){},271:function(e,t,a){},273:function(e,t,a){"use strict";a.r(t);var n,i=a(0),r=a.n(i),o=a(22),c=a.n(o),s=(a(146),a(147),a(148),a(7)),l=a(4);!function(e){e.TOP="TOP",e.BOTTOM="BOTTOM",e.LEFT="LEFT",e.RIGHT="RIGHT",e.TOP_RIGHT="TOP_RIGHT",e.TOP_LEFT="TOP_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.CENTER="CENTER"}(n||(n={}));var u,d=a(1);!function(e){e.LOAD_LABEL_NAMES="LOAD_LABEL_NAMES",e.LOAD_IMAGES="LOAD_IMAGES",e.EXPORT_LABELS="EXPORT_LABELS",e.INSERT_LABEL_NAMES="INSERT_LABEL_NAMES",e.EXIT_PROJECT="EXIT_PROJECT"}(u||(u={}));var g=function e(){Object(d.a)(this,e)};g.GITHUB_URL="https://github.com/SkalskiP",g.MEDIUM_URL="https://medium.com/@piotr.skalski92",g.PATREON_URL="https://www.patreon.com/make_sense",g.TOP_NAVIGATION_BAR_HEIGHT_PX=35,g.BOTTOM_NAVIGATION_BAR_HEIGHT_PX=46,g.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX=21,g.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX=g.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX+300+1,g.TOOLKIT_TAB_HEIGHT_PX=40,g.EDITOR_MIN_WIDTH=900,g.EDITOR_MIN_HEIGHT=500,g.PRIMARY_COLOR="#2af598",g.SECONDARY_COLOR="#009efd",g.DARK_THEME_FIRST_COLOR="#171717",g.DARK_THEME_SECOND_COLOR="#C9FF2F",g.DARK_THEME_THIRD_COLOR="#4c4c4c",g.DARK_THEME_FORTH_COLOR="#252f35",g.CANVAS_PADDING_WIDTH_PX=20,g.CROSS_HAIR_THICKNESS_PX=1,g.CROSS_HAIR_COLOR="#fff",g.RESIZE_HANDLE_DIMENSION_PX=6,g.RESIZE_HANDLE_HOVER_DIMENSION_PX=16,g.CLOSEABLE_POPUPS=[u.LOAD_IMAGES,u.LOAD_IMAGES,u.LOAD_IMAGES];var p,h=a(3),m=a(12),v=a(11),f=a(13);function b(e){return{type:p.UPDATE_PROJECT_TYPE,payload:{projectType:e}}}function y(e){return{type:p.UPDATE_ACTIVE_IMAGE_INDEX,payload:{activeImageIndex:e}}}function O(e){return{type:p.UPDATE_ACTIVE_LABEL_NAME_INDEX,payload:{activeLabelNameIndex:e}}}function E(e,t,a,n,i){return{type:p.UPDATE_LABEL_INDEX_BY_INFO,payload:{imageIndex:e,groupIndex:t,labelPointIndex:a,labelIndex:n,labelCheckd:i}}}function I(e){return{type:p.UPDATE_ACTIVE_LABEL_ID,payload:{activeLabelId:e}}}function A(e){return{type:p.UPDATE_HIGHLIGHTED_LABEL_ID,payload:{highlightedLabelId:e}}}function L(e){return{type:p.UPDATE_ACTIVE_LABEL_TYPE,payload:{activeLabelType:e}}}function P(e,t){return{type:p.UPDATE_IMAGE_DATA_BY_ID,payload:{id:e,newImageData:t}}}function C(e,t){return{type:p.ADD_IMAGES_DATA,payload:{imageData:e,inital:t}}}function T(e){return{type:p.UPDATE_IMAGES_DATA,payload:{imageData:e}}}function x(e){return{type:p.UPDATE_LABEL_NAMES_LIST,payload:{labelNames:e}}}function w(e){return{type:p.UPDATE_FIRST_LABEL_CREATED_FLAG,payload:{firstLabelCreatedFlag:e}}}function D(e){return{type:p.UPDATE_GROUP_LIST,payload:{groupName:e}}}function k(e){return{type:p.UPDATE_ACTIVE_GROUP_INDEX,payload:{groupIndex:e}}}function N(){return{type:p.FIND_NEXT_AVAILABLE_LABEL_INDEX}}!function(e){e.UPDATE_PROJECT_TYPE="@@UPDATE_PROJECT_TYPE",e.UPDATE_PROJECT_NAME="@@UPDATE_PROJECT_NAME",e.UPDATE_ACTIVE_IMAGE_INDEX="@@UPDATE_ACTIVE_IMAGE_INDEX",e.UPDATE_IMAGE_DATA_BY_ID="@@UPDATE_IMAGE_DATA_BY_ID",e.UPDATE_GROUP_DATA_BY_INDEX="@@UPDATE_GROUP_DATA_BY_INDEX",e.ADD_IMAGES_DATA="@@ADD_IMAGES_DATA",e.UPDATE_IMAGES_DATA="@@UPDATE_IMAGES_DATA",e.UPDATE_WINDOW_SIZE="@@UPDATE_WINDOW_SIZE",e.UPDATE_ACTIVE_POPUP_TYPE="@@UPDATE_ACTIVE_POPUP_TYPE",e.UPDATE_ACTIVE_LABEL_NAME_INDEX="@@UPDATE_ACTIVE_LABEL_NAME_INDEX",e.UPDATE_ACTIVE_LABEL_TYPE="@@UPDATE_ACTIVE_LABEL_TYPE",e.UPDATE_ACTIVE_LABEL_ID="@@UPDATE_ACTIVE_LABEL_ID",e.UPDATE_HIGHLIGHTED_LABEL_ID="@@UPDATE_HIGHLIGHTED_LABEL_ID",e.UPDATE_LABEL_NAMES_LIST="@@UPDATE_LABEL_NAMES_LIST",e.UPDATE_FIRST_LABEL_CREATED_FLAG="@@UPDATE_FIRST_LABEL_CREATED_FLAG",e.UPDATE_CUSTOM_CURSOR_STYLE="@@UPDATE_CUSTOM_CURSOR_STYLE",e.UPDATE_CONTEXT="@@UPDATE_CONTEXT",e.UPDATE_GROUP_LIST="@@UPDATE_GROUP_LIST",e.UPDATE_ACTIVE_GROUP_INDEX="@@UPDATE_ACTIVE_GROUP_INDEX",e.FIND_NEXT_AVAILABLE_LABEL_INDEX="@@FIND_NEXT_AVAILABLE_LABEL_INDEX",e.DELETE_GROUP_LIST="@@DELETE_GROUP_LIST",e.LOAD_DATA_FROM_LOCALSTORGE="@@LOAD_DATA_FROM_LOCALSTORGE",e.UPDATE_LABEL_INDEX_BY_INFO="@@UPDATE_LABEL_INDEX_BY_INFO",e.UPDATE_DIR_INFO="UPDATE_DIR_INFO"}(p||(p={}));var R=a(18),S=a.n(R),_=a(28),j=a(66),M=a(17),G=a.n(M),B=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"calculateGridSize",value:function(e,t,a){var n=Math.floor(e.width/t.width);return{width:n,height:Math.ceil(a/n)}}},{key:"calculateContentSize",value:function(e,t,a){var n={width:t.width*a.width,height:t.height*a.height};return{width:Math.max(e.width,n.width),height:n.height}}},{key:"calculateAnchorPoints",value:function(t,a,n){for(var i=e.calculateGridSize(t,a,n),r=(e.calculateContentSize(t,a,i).width-i.width*a.width)/(i.width+1),o=[],c=0;c<n;c++){var s=Math.floor(c/i.width),l={x:s*r+c%i.width*a.width,y:s*a.height};o.push(l)}return o}}]),e}(),z=a(9),U=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"snapValueToRange",value:function(e,t,a){return e<t?t:e>a?a:e}}]),e}();function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function H(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var V,W=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getRatio",value:function(e){return e?e.width/e.height:null}},{key:"intersect",value:function(e,t){return e&&t?!(t.x>e.x+e.width||t.x+t.width<e.x||t.y>e.y+e.height||t.y+t.height<e.y):null}},{key:"isPointInside",value:function(e,t){return e&&t?e.x<t.x&&e.x+e.width>t.x&&e.y<t.y&&e.y+e.height>t.y:null}},{key:"getRectWithCenterAndSize",value:function(e,t){return H({x:e.x-.5*t.width,y:e.y-.5*t.height},t)}},{key:"fitInsideRectWithRatio",value:function(t,a){if(e.getRatio(t)<a){var n=t.width/a;return{x:t.x,y:t.y+(t.height-n)/2,width:t.width,height:n}}var i=t.height*a;return{x:t.x+(t.width-i)/2,y:t.y,width:i,height:t.height}}},{key:"resizeRect",value:function(e,t,a){var i=H({},e);switch(t){case n.RIGHT:i.width+=a.x;break;case n.BOTTOM_RIGHT:i.width+=a.x,i.height+=a.y;break;case n.BOTTOM:i.height+=a.y;break;case n.TOP_RIGHT:i.width+=a.x,i.y+=a.y,i.height-=a.y;break;case n.TOP:i.y+=a.y,i.height-=a.y;break;case n.TOP_LEFT:i.x+=a.x,i.width-=a.x,i.y+=a.y,i.height-=a.y;break;case n.LEFT:i.x+=a.x,i.width-=a.x;break;case n.BOTTOM_LEFT:i.x+=a.x,i.width-=a.x,i.height+=a.y}return i.width<0&&(i.x=i.x+i.width,i.width=-i.width),i.height<0&&(i.y=i.y+i.height,i.height=-i.height),i}},{key:"translate",value:function(e,t){return H({},e,{x:e.x+t.x,y:e.y+t.y})}},{key:"expand",value:function(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width+2*t.x,height:e.height+2*t.y}}},{key:"scaleRect",value:function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}}},{key:"mapRectToAnchors",value:function(e){return[{type:n.TOP_LEFT,position:{x:e.x,y:e.y}},{type:n.TOP,position:{x:e.x+.5*e.width,y:e.y}},{type:n.TOP_RIGHT,position:{x:e.x+e.width,y:e.y}},{type:n.LEFT,position:{x:e.x,y:e.y+.5*e.height}},{type:n.RIGHT,position:{x:e.x+e.width,y:e.y+.5*e.height}},{type:n.BOTTOM_LEFT,position:{x:e.x,y:e.y+e.height}},{type:n.BOTTOM,position:{x:e.x+.5*e.width,y:e.y+e.height}},{type:n.BOTTOM_RIGHT,position:{x:e.x+e.width,y:e.y+e.height}}]}},{key:"snapPointToRect",value:function(t,a){return e.isPointInside(a,t)?t:{x:U.snapValueToRange(t.x,a.x,a.x+a.width),y:U.snapValueToRange(t.y,a.y,a.y+a.height)}}}]),e}(),X=a(24),Y=a.n(X),J=a(23),Z=a.n(J);!function(e){e.NAME="NAME",e.POINT="POINT",e.RECTANGLE="RECTANGLE",e.POLYGON="POLYGON",e.ALL="ALL"}(V||(V={}));var K=a(51),q="http://47.99.138.248",$=new K.a;function Q(e,t){return new Promise(function(a,n){var i=new XMLHttpRequest;i.open(e,t),i.responseType="blob",i.onload=function(){this.status>=200&&this.status<300?a(i.response):n({status:this.status,statusText:i.statusText})},i.onerror=function(){n({status:this.status,statusText:i.statusText})},i.send()})}function ee(e,t){return fetch(q+e,{body:JSON.stringify(t),cache:"no-cache",mode:"cors",headers:{Authorization:$.get("token"),"content-type":"application/json"},method:"POST"}).then(function(e){return e.json()})}function te(e){return fetch(q+e,{cache:"no-cache",mode:"cors",headers:{"content-type":"application/json",Authorization:$.get("token")},method:"GET"}).then(function(e){return e.json()})}var ae=new K.a,ne=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).gridSize=void 0,a.contentSize=void 0,a.childAnchors=void 0,a.scrollbars=void 0,a.calculate=function(e,t,n){a.gridSize=B.calculateGridSize(e,t,n),a.contentSize=B.calculateContentSize(e,t,a.gridSize),a.childAnchors=B.calculateAnchorPoints(e,t,n)},a.getVirtualListStyle=function(){return{position:"relative",width:a.props.size.width,height:a.props.size.height}},a.getVirtualListContentStyle=function(){return{width:a.contentSize.width,height:a.contentSize.height}},a.onScrollStart=function(){a.setState({isScrolling:!0})},a.onScrollStop=function(){a.setState({isScrolling:!1})},a.onScroll=function(e){if(1===e.top&&!a.state.isCompleted){if(a.state.loading)return void X.store.addNotification({title:"\u64cd\u4f5c\u9891\u7387\u592a\u5feb\u5566\uff5e\u8bf7\u7a0d\u5019",message:"\u56fe\u7247\u6b63\u5728\u52a0\u8f7d\u4e2d.....",type:"warning",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}});a.setState({loading:!0}),ee("/mark/sign/picList",{dir:ae.get("dirName"),pageNo:+ae.get("pageNo")+1,pageSize:+ae.get("pageSize")}).then(function(e){200===e.status&&(ae.set("pageNo",+ae.get("pageNo")+1),e.data.rows.length<+ae.get("pageSize")?a.setState({isCompleted:!0}):a.importImagesDataFromHttp(e.data.rows))})}a.setState({viewportRect:{x:e.scrollLeft,y:e.scrollTop,width:a.props.size.width,height:a.props.size.height}})},a.importImagesDataFromHttp=function(e){var t=Object(j.a)(a),n=[],i=0;e.forEach(function(){var a=Object(_.a)(S.a.mark(function a(r,o){var c,s,l;return S.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Q("get",r.url);case 2:c=a.sent,s=new File([c],r.id),(l=new FileReader).onabort=function(){return console.log("file reading was aborted")},l.onerror=function(){return console.log("file reading has failed")},l.onload=function(){var a=new Image;a.src=l.result,a.onload=function(a){s.width=this.width,s.height=this.height;var o=r.point?JSON.parse(r.point):[{activeLabelNameIndex:0,activeLabelType:V.POINT,activeLabelId:null,highlightedLabelId:null,firstLabelCreatedFlag:!1,labelRects:[],labelPoints:[],labelPolygons:[]}],c={activeGroupIndex:0,fileData:s,groupList:o,id:Z()(),loadStatus:!1};n.push(c),++i===e.length&&(n.sort(function(e,t){return+e.fileData.name-+t.fileData.name}),t.props.addImageData(n),t.setState({loading:!1}))}},l.readAsDataURL(s);case 9:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())},a.getChildren=function(){var e=a.state,t=e.viewportRect,n=e.isScrolling,i=a.props,r=i.overScanHeight,o=i.childSize,c=r||0,s={x:t.x,y:t.y-c,width:t.width,height:t.height+2*c};return a.childAnchors.reduce(function(e,t,i){var r=Object.assign(t,o),c=W.intersect(s,r);if(c){var l={position:"absolute",left:t.x,top:t.y,width:o.width,height:o.height};return e.concat(a.props.childRender(i,n,c,l))}return e},[])},a.state={viewportRect:null,isScrolling:!1,loading:!1,isCompleted:!1},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.size,a=e.childSize,n=e.childCount;this.calculate(t,a,n),this.setState({viewportRect:{x:0,y:0,width:this.props.size.width,height:this.props.size.height}})}},{key:"componentWillUpdate",value:function(e,t,a){var n=e.size,i=e.childSize,r=e.childCount;this.props.size.height===n.height&&this.props.size.width===n.width&&this.props.childCount===r||(this.calculate(n,i,r),this.setState({viewportRect:{x:this.scrollbars.getValues().scrollLeft,y:this.scrollbars.getValues().scrollTop,width:n.width,height:n.height}}))}},{key:"render",value:function(){var e=this,t=!!this.props.size&&!!this.props.childSize&&!!this.gridSize;return r.a.createElement("div",{className:"VirtualList",style:this.getVirtualListStyle()},r.a.createElement(G.a,{ref:function(t){return e.scrollbars=t},onScrollFrame:this.onScroll,onScrollStart:this.onScrollStart,onScrollStop:this.onScrollStop,autoHide:!0},t&&r.a.createElement("div",{className:"VirtualListContent",style:this.getVirtualListContentStyle()},this.getChildren())))}}]),t}(r.a.Component),ie={addImageData:C},re=Object(l.b)(function(){},ie)(ne),oe=a(10),ce=a.n(oe),se=a(139),le=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"add",value:function(t){e.queue.push(Object(_.a)(S.a.mark(function e(){return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})))}},{key:"run",value:function(){setTimeout(function(){return e.runQueue()},10)}},{key:"addAndRun",value:function(t){e.add(t),e.run()}},{key:"runQueue",value:function(){var t=Object(_.a)(S.a.mark(function t(){return S.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isRunning){t.next=5;break}return e.isRunning=!0,t.next=4,e.runTasks();case 4:e.isRunning=!1;case 5:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},{key:"runTasks",value:function(){var t=Object(_.a)(S.a.mark(function t(){var a;return S.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.queue.length>0)){t.next=6;break}return a=e.queue.shift(),t.next=4,a();case 4:t.next=0;break;case 6:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()}]),e}();le.queue=[],le.isRunning=!1;var ue=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"store",value:function(t,a){return e.repository[t]=a,t}},{key:"getById",value:function(t){return e.repository[t]}}]),e}();ue.repository={};var de=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"mapFileDataToImageData",value:function(e){if(JSON.parse(localStorage.getItem(e.name))){var t=JSON.parse(localStorage.getItem(e.name));return t.fileData=e,t.loadStatus=!1,t}return{id:Z()(),fileData:e,loadStatus:!1,activeGroupIndex:0,groupList:[{labelRects:[],labelPoints:[],labelPolygons:[],activeLabelNameIndex:0,activeLabelType:null,activeLabelId:null,highlightedLabelId:null,firstLabelCreatedFlag:!1}]}}},{key:"loadImage",value:function(e,t,a){return new Promise(function(n,i){var r=URL.createObjectURL(e),o=new Image;o.src=r,o.onload=function(){t(o),n()},o.onerror=function(){a(),i()}})}},{key:"loadLabelsList",value:function(e,t,a){var n=new FileReader;n.readAsText(e),n.onloadend=function(e){var a=e.target.result;t(a.split(/[\r\n]/))},n.onerror=function(){return a()}}}]),e}();a(178);function ge(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function pe(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ge(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ge(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var he,me=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).isLoading=!1,a.loadImage=function(){var e=Object(_.a)(S.a.mark(function e(t,n){var i,r;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loadStatus){e.next=5;break}i=ue.getById(t.id),a.state.image!==i&&a.setState({image:i}),e.next=10;break;case 5:if(n&&a.isLoading){e.next=10;break}return a.isLoading=!0,r=function(e){return a.saveLoadedImage(e,t)},e.next=10,de.loadImage(t.fileData,r,a.handleLoadImageError);case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.saveLoadedImage=function(e,t){a.props.updateImageDataById(t.id,pe({},t,{loadStatus:!0})),ue.store(t.id,e),t.id===a.props.imageData.id&&(a.setState({image:e}),a.isLoading=!1)},a.getStyle=function(){var e=a.props.size,t={x:.15*e.width,y:.15*e.height,width:.7*e.width,height:.7*e.height},n={x:0,y:0,width:a.state.image.width,height:a.state.image.height},i=W.getRatio(n),r=W.fitInsideRectWithRatio(t,i);return{width:r.width,height:r.height,left:r.x,top:r.y}},a.handleLoadImageError=function(){},a.getClassName=function(){return ce()("ImagePreview",{selected:a.props.isSelected})},a.state={image:null},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){le.addAndRun(this.loadImage(this.props.imageData,this.props.isScrolling))}},{key:"componentWillUpdate",value:function(e,t,a){this.props.imageData.id!==e.imageData.id&&(e.imageData.loadStatus?le.addAndRun(this.loadImage(e.imageData,e.isScrolling)):this.setState({image:null})),this.props.isScrolling&&!e.isScrolling&&le.addAndRun(this.loadImage(e.imageData,!1))}},{key:"shouldComponentUpdate",value:function(e,t,a){return this.props.imageData.id!==e.imageData.id||this.state.image!==t.image||this.props.isSelected!==e.isSelected||this.props.isChecked!==e.isChecked}},{key:"render",value:function(){var e=this.props,t=e.isChecked,a=e.style,n=e.onClick,i=e.index;return r.a.createElement("div",{className:this.getClassName(),style:a,onClick:n||void 0,"data-index":i},this.state.image?[r.a.createElement("div",{className:"Foreground",key:"Foreground",style:this.getStyle()},r.a.createElement("img",{className:"Image",draggable:!1,src:this.state.image.src,alt:this.state.image.alt,style:pe({},this.getStyle(),{left:0,top:0})}),t&&r.a.createElement("img",{className:"CheckBox",draggable:!1,src:"ico/checkbox-checked-color.png",alt:"checkbox"})),r.a.createElement("div",{className:"Background",key:"Background",style:this.getStyle()})]:r.a.createElement(se.a,{sizeUnit:"px",size:30,color:g.SECONDARY_COLOR,loading:!0}))}}]),t}(r.a.Component),ve={updateImageDataById:P},fe=Object(l.b)(function(e){return{}},ve)(me);a(179);function be(e){return{type:p.UPDATE_ACTIVE_POPUP_TYPE,payload:{activePopupType:e}}}function ye(e){return{type:p.UPDATE_CUSTOM_CURSOR_STYLE,payload:{customCursorStyle:e}}}!function(e){e.EDITOR="EDITOR",e.LEFT_NAVBAR="LEFT_NAVBAR",e.RIGHT_NAVBAR="RIGHT_NAVBAR",e.POPUP="POPUP",e.DROPDOWN="DROPDOWN"}(he||(he={}));var Oe=a(36),Ee=a.n(Oe),Ie=function e(){Object(d.a)(this,e)};Ie.canvas=void 0,Ie.mousePositionIndicator=void 0,Ie.cursor=void 0,Ie.primaryRenderingEngine=void 0,Ie.supportRenderingEngine=void 0,Ie.image=void 0,Ie.imageRectOnCanvas=void 0,Ie.imageScale=void 0,Ie.mousePositionOnCanvas=void 0,Ie.isLoading=!1;var Ae,Le=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"deg2rad",value:function(e){return e*Math.PI/180}},{key:"rad2deg",value:function(e){return 180*e/Math.PI}}]),e}(),Pe=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"clearCanvas",value:function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}},{key:"drawLine",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#111111",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=e.getContext("2d");r.save(),r.strokeStyle=n,r.lineWidth=i,r.lineCap="round",r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(a.x+1,a.y+1),r.stroke(),r.restore()}},{key:"drawRect",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fff",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=e.getContext("2d");i.save(),i.strokeStyle=a,i.lineWidth=n,i.beginPath(),i.rect(t.x,t.y,t.width,t.height),i.stroke(),i.restore()}},{key:"drawRectWithFill",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ADCC53",n=e.getContext("2d");n.save(),n.fillStyle=a,n.beginPath(),n.rect(t.x,t.y,t.width,t.height),n.fill(),n.restore()}},{key:"shadeEverythingButRect",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgba(0, 0, 0, 0.7)",n=e.getContext("2d");n.save(),n.fillStyle=a,n.fillRect(0,0,e.width,e.height),n.globalCompositeOperation="destination-out",n.fillRect(t.x,t.y,t.width,t.height),n.restore()}},{key:"drawCircleWithFill",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#ffffff",i=e.getContext("2d");i.save();var r=Le.deg2rad(0),o=Le.deg2rad(360);i.fillStyle=n,i.beginPath(),i.arc(t.x,t.y,a,r,o,!1),i.fill(),i.restore()}},{key:"drawCircle",value:function(e,t,a,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#ffffff",c=e.getContext("2d"),s=Le.deg2rad(n),l=Le.deg2rad(i);c.save(),c.strokeStyle=o,c.lineWidth=r,c.beginPath(),c.arc(t.x,t.y,a,s,l,!1),c.stroke(),c.restore()}},{key:"drawPolygon",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fff",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=e.getContext("2d");i.save(),i.strokeStyle=a,i.lineWidth=n,i.beginPath(),i.moveTo(t[0].x,t[0].y);for(var r=1;r<t.length;r++)i.lineTo(t[r].x,t[r].y);i.closePath(),i.stroke(),i.restore()}},{key:"drawPolygonWithFill",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#fff",n=e.getContext("2d");n.save(),n.fillStyle=a,n.beginPath(),n.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++)n.lineTo(t[i].x,t[i].y);n.closePath(),n.fill(),n.restore()}},{key:"drawText",value:function(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#ffffff",r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"center",c=e.getContext("2d");c.save(),c.fillStyle=i,c.textAlign=o,c.textBaseline="middle",c.font=(r?"bold ":"")+a+"px Arial",c.fillText(t,n.x,n.y),c.restore()}},{key:"getRandomRGBColor",value:function(){return"rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")"}},{key:"hexToRGB",value:function(e,t){var a=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return t?"rgba("+a+", "+n+", "+i+", "+t+")":"rgb("+a+", "+n+", "+i+")"}}]),e}(),Ce=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"equals",value:function(e,t){return e.x===t.x&&e.y===t.y}},{key:"add",value:function(e,t){return{x:e.x+t.x,y:e.y+t.y}}},{key:"subtract",value:function(e,t){return{x:e.x-t.x,y:e.y-t.y}}},{key:"multiply",value:function(e,t){return{x:e.x*t,y:e.y*t}}},{key:"devide",value:function(e,t){return{x:e.x/t,y:e.y/t}}},{key:"getEuclidianDistance",value:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}}]),e}(),Te=function e(){Object(d.a)(this,e),this.lineThickness=2,this.lineActiveColor=g.PRIMARY_COLOR,this.lineInactiveColor="#fff",this.anchorSize={width:g.RESIZE_HANDLE_DIMENSION_PX,height:g.RESIZE_HANDLE_DIMENSION_PX},this.anchorHoverSize={width:g.RESIZE_HANDLE_HOVER_DIMENSION_PX,height:g.RESIZE_HANDLE_HOVER_DIMENSION_PX},this.suggestedAnchorDetectionSize={width:100,height:100},this.activeAnchorColor=g.SECONDARY_COLOR,this.inactiveAnchorColor=g.DARK_THEME_SECOND_COLOR};!function(e){e.DEFAULT="DEFAULT",e.MOVE="MOVE",e.RESIZE="RESIZE",e.ADD="ADD",e.CANCEL="CANCEL",e.CLOSE="CLOSE"}(Ae||(Ae={}));var xe,we=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getProjectName",value:function(){return Ja.getState().editor.projectName}},{key:"getLabelNames",value:function(){return Ja.getState().editor.labelNames}},{key:"getActiveImageIndex",value:function(){return Ja.getState().editor.activeImageIndex}},{key:"getActiveGroupIndex",value:function(){return Ja.getState().editor.imagesData[this.getActiveImageIndex()].activeGroupIndex}},{key:"getActiveLabelNameIndex",value:function(){return Ja.getState().editor.imagesData[this.getActiveImageIndex()].groupList[this.getActiveGroupIndex()].activeLabelNameIndex}},{key:"getLabelNameLength",value:function(){return Ja.getState().editor.labelNames.length}},{key:"getImagesData",value:function(){return Ja.getState().editor.imagesData}},{key:"getActiveImageData",value:function(){var t=e.getActiveImageIndex();return null===t?null:e.getImagesData()[t]}},{key:"getActiveLabelId",value:function(){var e=Ja.getState().editor.imagesData[this.getActiveImageIndex()].groupList[this.getActiveGroupIndex()].activeLabelId;return e}},{key:"getHighlightedLabelId",value:function(){return Ja.getState().editor.imagesData[this.getActiveImageIndex()].groupList[this.getActiveGroupIndex()].highlightedLabelId}},{key:"getActiveRectLabel",value:function(){var t=e.getActiveLabelId(),a=e.getActiveGroupIndex();return null===t?null:Ee.a.find(e.getActiveImageData().groupList[a].labelRects,{id:t})}},{key:"getActivePointLabel",value:function(){var t=e.getActiveLabelId(),a=e.getActiveGroupIndex();return null===t?null:Ee.a.find(e.getActiveImageData().groupList[a].labelPoints,{id:t})}},{key:"getAllPointLabelIndex",value:function(){var t=e.getActiveGroupIndex();return e.getActiveImageData().groupList[t].labelPoints.map(function(e){return e.labelIndex})}},{key:"getActivePolygonLabel",value:function(){var t=e.getActiveLabelId(),a=e.getActiveGroupIndex();return null===t?null:Ee.a.find(e.getActiveImageData().groupList[a].labelPolygons,{id:t})}},{key:"getActiveLabelType",value:function(){return e.getActiveImageData()?e.getActiveImageData().groupList[e.getActiveGroupIndex()].activeLabelType:V.POINT}},{key:"getFirstLabelCreatedFlag",value:function(){return e.getActiveImageData().groupList[e.getActiveGroupIndex()].firstLabelCreatedFlag}}]),e}();!function(e){e.MOUSE_UP="mouseup",e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.KEY_DOWN="keydown",e.KEY_UP="keyup"}(xe||(xe={}));var De=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getEventType",value:function(e){if(!e)return null;switch(e.type){case xe.MOUSE_DOWN:return xe.MOUSE_DOWN;case xe.MOUSE_UP:return xe.MOUSE_UP;case xe.MOUSE_MOVE:return xe.MOUSE_MOVE;default:return null}}}]),e}(),ke=function(){function e(t){Object(d.a)(this,e),this.canvas=void 0,this.labelType=void 0,this.canvas=t}return Object(h.a)(e,[{key:"update",value:function(e){if(e.event)switch(De.getEventType(e.event)){case xe.MOUSE_MOVE:this.mouseMoveHandler(e);break;case xe.MOUSE_UP:this.mouseUpHandler(e);break;case xe.MOUSE_DOWN:this.mouseDownHandler(e)}}}]),e}();function Ne(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var Re=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"isMouseOverImage",value:function(e){return W.isPointInside(e.activeImageRectOnCanvas,e.mousePositionOnCanvas)}},{key:"isMouseOverCanvas",value:function(e){return W.isPointInside(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ne(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ne(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({x:0,y:0},e.canvasSize),e.mousePositionOnCanvas)}},{key:"transferPolygonFromImageToCanvas",value:function(t,a){return t.map(function(t){return e.transferPointFromImageToCanvas(t,a)})}},{key:"transferPointFromImageToCanvas",value:function(e,t){return Ce.add(Ce.multiply(e,1/t.activeImageScale),t.activeImageRectOnCanvas)}},{key:"transferPolygonFromCanvasToImage",value:function(t,a){return t.map(function(t){return e.transferPointFromCanvasToImage(t,a)})}},{key:"transferPointFromCanvasToImage",value:function(e,t){return Ce.multiply(Ce.subtract(e,t.activeImageRectOnCanvas),t.activeImageScale)}},{key:"transferRectFromCanvasToImage",value:function(e,t){return W.translate(W.scaleRect(e,1/t.activeImageScale),t.activeImageRectOnCanvas)}},{key:"wrapDefaultCursorStyleInCancel",value:function(e){W.isPointInside(e.activeImageRectOnCanvas,e.mousePositionOnCanvas)?Ja.dispatch(ye(Ae.DEFAULT)):Ja.dispatch(ye(Ae.CANCEL))}},{key:"setValueBetweenPixels",value:function(e){return Math.floor(e)+.5}},{key:"setPointBetweenPixels",value:function(t){return{x:e.setValueBetweenPixels(t.x),y:e.setValueBetweenPixels(t.y)}}},{key:"setRectBetweenPixels",value:function(t){var a={x:t.x,y:t.y},n={x:t.x+t.width,y:t.y+t.height},i=e.setPointBetweenPixels(a),r=e.setPointBetweenPixels(n);return{x:i.x,y:i.y,width:r.x-i.x,height:r.y-i.y}}}]),e}(),Se=a(14);function _e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var je=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).config=new Te,a.startCreateRectPoint=void 0,a.startResizeRectAnchor=void 0,a.mouseDownHandler=function(e){var t=Re.isMouseOverImage(e);if(Re.isMouseOverCanvas(e)){var n=a.getRectUnderMouse(e.activeImageScale,e.activeImageRectOnCanvas,e.mousePositionOnCanvas);if(n){var i=a.calculateRectRelativeToActiveImage(n.rect,e.activeImageScale),r=a.getAnchorUnderMouseByRect(i,e.mousePositionOnCanvas,e.activeImageRectOnCanvas);r?(Ja.dispatch(I(n.id)),a.startRectResize(r)):we.getHighlightedLabelId()?Ja.dispatch(I(we.getHighlightedLabelId())):a.startRectCreation(e.mousePositionOnCanvas)}else t&&a.startRectCreation(e.mousePositionOnCanvas)}},a.mouseUpHandler=function(e){if(e.activeImageRectOnCanvas){var t=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas);if(a.startCreateRectPoint&&!Ce.equals(a.startCreateRectPoint,t)){var n=Math.min(a.startCreateRectPoint.x,t.x),i=Math.min(a.startCreateRectPoint.y,t.y),r=Math.max(a.startCreateRectPoint.x,t.x),o=Math.max(a.startCreateRectPoint.y,t.y),c={x:(n-e.activeImageRectOnCanvas.x)*e.activeImageScale,y:(i-e.activeImageRectOnCanvas.y)*e.activeImageScale,width:(r-n)*e.activeImageScale,height:(o-i)*e.activeImageScale};a.addRectLabel(c)}if(a.startResizeRectAnchor){var s=we.getActiveRectLabel(),l=a.calculateRectRelativeToActiveImage(s.rect,e.activeImageScale),u=Ce.add(a.startResizeRectAnchor.position,e.activeImageRectOnCanvas),d=Ce.subtract(t,u),g=W.resizeRect(l,a.startResizeRectAnchor.type,d),p=W.scaleRect(g,e.activeImageScale),h=we.getActiveImageData(),m=we.getActiveGroupIndex(),v=Object(Se.a)(h,function(e){e.groupList[m].labelRects=h.groupList[m].labelRects.map(function(e){return e.id===s.id?function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_e(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_e(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},e,{rect:p}):e})});Ja.dispatch(P(h.id,v))}}a.endRectTransformation()},a.mouseMoveHandler=function(e){if(e.activeImageRectOnCanvas&&e.mousePositionOnCanvas&&(Re.isMouseOverImage(e)&&!a.startResizeRectAnchor)){var t=a.getRectUnderMouse(e.activeImageScale,e.activeImageRectOnCanvas,e.mousePositionOnCanvas);t?we.getHighlightedLabelId()!==t.id&&Ja.dispatch(A(t.id)):null!==we.getHighlightedLabelId()&&Ja.dispatch(A(null))}},a.addRectLabel=function(e){var t=we.getActiveLabelNameIndex(),a=we.getActiveImageData(),n={id:Z()(),labelIndex:t,checked:!1,rect:e};a.groupList[we.getActiveGroupIndex()].labelRects.push(n),Ja.dispatch(P(a.id,a)),Ja.dispatch(w(!0)),Ja.dispatch(I(n.id))},a.labelType=V.RECTANGLE,a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(e){var t=this,a=we.getActiveLabelId(),n=we.getActiveImageData(),i=we.getActiveGroupIndex();n&&(n.groupList[i].labelRects.forEach(function(n){n.id===a?t.drawActiveRect(n,e.mousePositionOnCanvas,e.activeImageRectOnCanvas,e.activeImageScale):t.drawInactiveRect(n,e)}),this.drawCurrentlyCreatedRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas),this.updateCursorStyle(e))}},{key:"drawCurrentlyCreatedRect",value:function(e,t){if(this.startCreateRectPoint){var a=W.snapPointToRect(e,t),n={x:this.startCreateRectPoint.x,y:this.startCreateRectPoint.y,width:a.x-this.startCreateRectPoint.x,height:a.y-this.startCreateRectPoint.y},i=Re.setRectBetweenPixels(n);Pe.drawRect(this.canvas,i,this.config.lineActiveColor,this.config.lineThickness)}}},{key:"drawInactiveRect",value:function(e,t){var a=Re.transferRectFromCanvasToImage(e.rect,t),n=we.getHighlightedLabelId();this.renderRect(a,e.id===n)}},{key:"drawActiveRect",value:function(e,t,a,n){var i=this.calculateRectRelativeToActiveImage(e.rect,n);if(this.startResizeRectAnchor){var r=Ce.add(this.startResizeRectAnchor.position,a),o=W.snapPointToRect(t,a),c=Ce.subtract(o,r);i=W.resizeRect(i,this.startResizeRectAnchor.type,c)}var s=W.translate(i,a);this.renderRect(s,!0)}},{key:"renderRect",value:function(e,t){var a=this,n=Re.setRectBetweenPixels(e),i=t?this.config.lineActiveColor:this.config.lineInactiveColor;(Pe.drawRect(this.canvas,n,i,this.config.lineThickness),t)&&W.mapRectToAnchors(e).map(function(e){return e.position}).forEach(function(e){var t=W.getRectWithCenterAndSize(e,a.config.anchorSize),n=Re.setRectBetweenPixels(t);Pe.drawRectWithFill(a.canvas,n,a.config.activeAnchorColor)})}},{key:"updateCursorStyle",value:function(e){if(this.canvas&&e.mousePositionOnCanvas){if(this.getAnchorUnderMouse(e.activeImageScale,e.mousePositionOnCanvas,e.activeImageRectOnCanvas)||this.startResizeRectAnchor)return void Ja.dispatch(ye(Ae.MOVE));Re.isMouseOverCanvas(e)?(!W.isPointInside(e.activeImageRectOnCanvas,e.mousePositionOnCanvas)&&this.startCreateRectPoint?Ja.dispatch(ye(Ae.MOVE)):Re.wrapDefaultCursorStyleInCancel(e),this.canvas.style.cursor="none"):this.canvas.style.cursor="default"}}},{key:"isInProgress",value:function(){return!!this.startCreateRectPoint||!!this.startResizeRectAnchor}},{key:"calculateRectRelativeToActiveImage",value:function(e,t){return W.scaleRect(e,1/t)}},{key:"getRectUnderMouse",value:function(e,t,a){var n=we.getActiveRectLabel();if(n&&this.isMouseOverRectEdges(n.rect,e,t,a))return n;for(var i=we.getActiveImageData().groupList[we.getActiveGroupIndex()].labelRects,r=0;r<i.length;r++)if(this.isMouseOverRectEdges(i[r].rect,e,t,a))return i[r];return null}},{key:"isMouseOverRectEdges",value:function(e,t,a,n){var i=W.translate(this.calculateRectRelativeToActiveImage(e,t),a),r={x:this.config.anchorHoverSize.width/2,y:this.config.anchorHoverSize.height/2},o=W.expand(i,r),c={x:-this.config.anchorHoverSize.width/2,y:-this.config.anchorHoverSize.height/2},s=W.expand(i,c);return W.isPointInside(o,n)&&!W.isPointInside(s,n)}},{key:"getAnchorUnderMouseByRect",value:function(e,t,a){for(var n=W.mapRectToAnchors(e),i=0;i<n.length;i++){var r=W.translate(W.getRectWithCenterAndSize(n[i].position,this.config.anchorHoverSize),a);if(t&&W.isPointInside(r,t))return n[i]}return null}},{key:"getAnchorUnderMouse",value:function(e,t,a){for(var n=we.getActiveImageData().groupList[we.getActiveGroupIndex()].labelRects,i=0;i<n.length;i++){var r=this.calculateRectRelativeToActiveImage(n[i].rect,e),o=this.getAnchorUnderMouseByRect(r,t,a);if(o)return o}return null}},{key:"startRectCreation",value:function(e){this.startCreateRectPoint=e,Ja.dispatch(I(null))}},{key:"startRectResize",value:function(e){this.startResizeRectAnchor=e}},{key:"endRectTransformation",value:function(){this.startCreateRectPoint=null,this.startResizeRectAnchor=null}}]),t}(ke),Me=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getMousePositionOnCanvasFromEvent",value:function(e,t){if(t&&e){var a=t.getBoundingClientRect();return{x:e.clientX-a.left,y:e.clientY-a.top}}return null}},{key:"getClientRect",value:function(e){if(e){var t=e.getBoundingClientRect();return{x:t.left,y:t.top,width:t.width,height:t.height}}return null}},{key:"getSize",value:function(e){if(e){var t=e.getBoundingClientRect();return{width:t.width,height:t.height}}return null}}]),e}();function Ge(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Be(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ge(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ge(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var ze=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).config=new Te,a.transformInProgress=!1,a.addPointLabel=function(e){var t=we.getActiveLabelNameIndex(),a=we.getActiveGroupIndex(),n=we.getActiveImageData(),i=we.getAllPointLabelIndex(),r=we.getLabelNameLength(),o={id:Z()(),labelIndex:t,checked:!1,point:e};if(i.length!==r){var c=Object(Se.a)(n,function(e){e.groupList[a].labelPoints.push(o)});Ja.dispatch(P(n.id,c)),Ja.dispatch(w(!0)),Ja.dispatch(I(o.id)),Ja.dispatch(N())}else X.store.addNotification({message:"\u5df2\u7ecf\u6dfb\u52a0\u5168\u90e8\u7684\u5173\u8282",type:"warning",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}})},a.labelType=V.POINT,a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"mouseDownHandler",value:function(e){var t=Re.isMouseOverImage(e);if(Re.isMouseOverCanvas(e)){var a=this.getLabelPointUnderMouse(e.mousePositionOnCanvas,e);if(a){var n=Re.transferPointFromImageToCanvas(a.point,e),i=Re.setPointBetweenPixels(n),r=W.getRectWithCenterAndSize(i,this.config.anchorHoverSize);if(W.isPointInside(r,e.mousePositionOnCanvas))return Ja.dispatch(I(a.id)),void(this.transformInProgress=!0);Ja.dispatch(I(null));var o=Re.transferPointFromCanvasToImage(e.mousePositionOnCanvas,e);this.addPointLabel(o)}else if(t){var c=Re.transferPointFromCanvasToImage(e.mousePositionOnCanvas,e);this.addPointLabel(c)}}}},{key:"mouseUpHandler",value:function(e){if(this.isInProgress()){var t=we.getActivePointLabel(),a=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas),n=Re.transferPointFromCanvasToImage(a,e),i=we.getActiveImageData(),r=we.getActiveGroupIndex(),o=Object(Se.a)(i,function(e){e.groupList[r].labelPoints=i.groupList[r].labelPoints.map(function(e){return t&&e.id===t.id?Be({},e,{point:n}):e})});Ja.dispatch(P(i.id,o))}this.transformInProgress=!1}},{key:"mouseMoveHandler",value:function(e){if(Re.isMouseOverImage(e)){var t=this.getLabelPointUnderMouse(e.mousePositionOnCanvas,e);t?we.getHighlightedLabelId()!==t.id&&Ja.dispatch(A(t.id)):null!==we.getHighlightedLabelId()&&Ja.dispatch(A(null))}}},{key:"render",value:function(e){var t=this;if(e.activeImageRectOnCanvas){var a=we.getActiveLabelId(),n=we.getHighlightedLabelId(),i=we.getActiveImageData();if(i){var r=we.getActiveGroupIndex();i.groupList[r].labelPoints.forEach(function(i){if(i.id===a)if(t.isInProgress()){var r=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas),o=Re.setPointBetweenPixels(r),c=W.getRectWithCenterAndSize(o,t.config.anchorSize);Pe.drawRectWithFill(t.canvas,c,t.config.activeAnchorColor)}else t.renderPoint(i,!0,e);else t.renderPoint(i,i.id===a||i.id===n,e)})}this.updateCursorStyle(e)}}},{key:"renderPoint",value:function(e,t,a){var n=Re.transferPointFromImageToCanvas(e.point,a),i=Re.setPointBetweenPixels(n),r=W.getRectWithCenterAndSize(i,this.config.anchorSize),o=t?this.config.activeAnchorColor:this.config.inactiveAnchorColor;Pe.drawRectWithFill(this.canvas,r,o)}},{key:"updateCursorStyle",value:function(e){if(this.canvas&&e.mousePositionOnCanvas){var t=this.getLabelPointUnderMouse(e.mousePositionOnCanvas,e);if(t){var a=Re.transferPointFromImageToCanvas(t.point,e),n=Re.setPointBetweenPixels(a),i=W.getRectWithCenterAndSize(n,this.config.anchorHoverSize);if(W.isPointInside(i,e.mousePositionOnCanvas))return void Ja.dispatch(ye(Ae.MOVE))}else if(this.isInProgress())return void Ja.dispatch(ye(Ae.MOVE));W.isPointInside(Be({x:0,y:0},Me.getSize(this.canvas)),e.mousePositionOnCanvas)?(Re.wrapDefaultCursorStyleInCancel(e),this.canvas.style.cursor="none"):this.canvas.style.cursor="default"}}},{key:"isInProgress",value:function(){return this.transformInProgress}},{key:"getLabelPointUnderMouse",value:function(e,t){for(var a=we.getActiveGroupIndex(),n=we.getActiveImageData().groupList[a].labelPoints,i=0;i<n.length;i++){var r=Re.transferPointFromImageToCanvas(n[i].point,t),o=W.getRectWithCenterAndSize(r,this.config.anchorHoverSize);if(W.isPointInside(o,e))return n[i]}return null}}]),t}(ke),Ue=a(29),Fe=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getDistanceFromLine",value:function(e,t){return e.start.x!==e.end.x||e.start.y!==e.end.y?Math.abs((e.end.y-e.start.y)*t.x-(e.end.x-e.start.x)*t.y+e.end.x*e.start.y-e.end.y*e.start.x)/Math.sqrt(Math.pow(e.end.y-e.start.y,2)+Math.pow(e.end.x-e.start.x,2)):null}},{key:"getCenter",value:function(e){return{x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2}}}]),e}();function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?He(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var We=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).config=new Te,a.activePath=[],a.resizeAnchorIndex=null,a.suggestedAnchorPositionOnCanvas=null,a.suggestedAnchorIndexInPolygon=null,a.labelType=V.POLYGON,a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"update",value:function(e){if(e.event)switch(De.getEventType(e.event)){case xe.MOUSE_MOVE:this.mouseMoveHandler(e);break;case xe.MOUSE_UP:this.mouseUpHandler(e);break;case xe.MOUSE_DOWN:this.mouseDownHandler(e)}}},{key:"mouseDownHandler",value:function(e){var t=this;if(Re.isMouseOverCanvas(e))if(this.isCreationInProgress()){this.isMouseOverAnchor(e.mousePositionOnCanvas,this.activePath[0])?this.addLabelAndFinishCreation(e):this.updateActivelyCreatedLabel(e)}else{var a=this.getPolygonUnderMouse(e);if(a){var n=a.vertices.reduce(function(a,n,i){if(null===a){var r=Re.transferPointFromImageToCanvas(n,e);if(t.isMouseOverAnchor(e.mousePositionOnCanvas,r))return i}return a},null);if(null!==n)this.startExistingLabelResize(e,a.id,n);else this.isMouseOverAnchor(e.mousePositionOnCanvas,this.suggestedAnchorPositionOnCanvas)?(Ja.dispatch(I(a.id)),this.addSuggestedAnchorToPolygonLabel(e)):this.updateActivelyCreatedLabel(e)}else this.updateActivelyCreatedLabel(e)}}},{key:"mouseUpHandler",value:function(e){this.isResizeInProgress()&&this.endExistingLabelResize(e)}},{key:"mouseMoveHandler",value:function(e){if(e.activeImageRectOnCanvas&&e.mousePositionOnCanvas&&(Re.isMouseOverImage(e)&&!this.isCreationInProgress())){var t=this.getPolygonUnderMouse(e);if(t&&!this.isResizeInProgress()){we.getHighlightedLabelId()!==t.id&&Ja.dispatch(A(t.id));for(var a=Re.transferPolygonFromImageToCanvas(t.vertices,e),n=this.mapPointsToLines(a.concat(a[0])),i=0;i<n.length;i++)if(this.isMouseOverLine(e.mousePositionOnCanvas,n[i])){this.suggestedAnchorPositionOnCanvas=Fe.getCenter(n[i]),this.suggestedAnchorIndexInPolygon=i+1;break}}else null!==we.getHighlightedLabelId()&&(Ja.dispatch(A(null)),this.discardSuggestedPoint())}}},{key:"render",value:function(e){we.getActiveImageData()&&(this.drawExistingLabels(e),this.drawActivelyCreatedLabel(e),this.drawActivelyResizeLabel(e),this.updateCursorStyle(e),this.drawSuggestedAnchor(e))}},{key:"updateCursorStyle",value:function(e){if(this.canvas&&e.mousePositionOnCanvas)if(Re.isMouseOverCanvas(e)){if(this.isCreationInProgress()){this.isMouseOverAnchor(e.mousePositionOnCanvas,this.activePath[0])&&this.activePath.length>2?Ja.dispatch(ye(Ae.CLOSE)):Ja.dispatch(ye(Ae.DEFAULT))}else{var t=this.getAnchorUnderMouse(e);this.isMouseOverAnchor(e.mousePositionOnCanvas,this.suggestedAnchorPositionOnCanvas)?Ja.dispatch(ye(Ae.ADD)):this.isResizeInProgress()?Ja.dispatch(ye(Ae.MOVE)):t?Ja.dispatch(ye(Ae.MOVE)):Re.wrapDefaultCursorStyleInCancel(e)}this.canvas.style.cursor="none"}else this.canvas.style.cursor="default"}},{key:"drawActivelyCreatedLabel",value:function(e){var t=this,a=this.activePath.map(function(e){return Re.setPointBetweenPixels(e)}),n=a.concat(e.mousePositionOnCanvas),i=this.mapPointsToLines(n);Pe.drawPolygonWithFill(this.canvas,n,Pe.hexToRGB(this.config.lineActiveColor,.2)),i.forEach(function(e){Pe.drawLine(t.canvas,e.start,e.end,t.config.lineActiveColor,t.config.lineThickness)}),this.mapPointsToAnchors(a).forEach(function(e){Pe.drawRectWithFill(t.canvas,e,t.config.activeAnchorColor)})}},{key:"drawActivelyResizeLabel",value:function(e){var t=this,a=we.getActivePolygonLabel();if(a&&this.isResizeInProgress()){var n=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas),i=a.vertices.map(function(a,i){return i===t.resizeAnchorIndex?n:Re.transferPointFromImageToCanvas(a,e)});this.drawPolygon(i,!0)}}},{key:"drawExistingLabels",value:function(e){var t=this,a=we.getActiveLabelId(),n=we.getHighlightedLabelId(),i=we.getActiveImageData(),r=we.getActiveGroupIndex();i.groupList[r].labelPolygons.forEach(function(i){var r=i.id===a||i.id===n,o=Re.transferPolygonFromImageToCanvas(i.vertices,e);i.id===a&&t.isResizeInProgress()||t.drawPolygon(o,r)})}},{key:"drawPolygon",value:function(e,t){var a=this,n=t?this.config.lineActiveColor:this.config.lineInactiveColor,i=e.map(function(e){return Re.setPointBetweenPixels(e)});t&&Pe.drawPolygonWithFill(this.canvas,i,Pe.hexToRGB(n,.2)),Pe.drawPolygon(this.canvas,i,n,this.config.lineThickness),t&&this.mapPointsToAnchors(i).forEach(function(e){Pe.drawRectWithFill(a.canvas,e,a.config.activeAnchorColor)})}},{key:"drawSuggestedAnchor",value:function(e){if(this.suggestedAnchorPositionOnCanvas){var t=W.getRectWithCenterAndSize(this.suggestedAnchorPositionOnCanvas,this.config.suggestedAnchorDetectionSize);if(W.isPointInside(t,e.mousePositionOnCanvas)){var a=W.getRectWithCenterAndSize(this.suggestedAnchorPositionOnCanvas,this.config.anchorSize);Pe.drawRectWithFill(this.canvas,a,this.config.lineInactiveColor)}}}},{key:"updateActivelyCreatedLabel",value:function(e){if(this.isCreationInProgress()){var t=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas);this.activePath.push(t)}else{W.isPointInside(e.activeImageRectOnCanvas,e.mousePositionOnCanvas)&&(this.activePath.push(e.mousePositionOnCanvas),Ja.dispatch(I(null)))}}},{key:"cancelLabelCreation",value:function(){this.activePath=[]}},{key:"finishLabelCreation",value:function(){this.activePath=[]}},{key:"addLabelAndFinishCreation",value:function(e){if(this.isCreationInProgress()&&this.activePath.length>2){var t=Re.transferPolygonFromCanvasToImage(this.activePath,e);this.addPolygonLabel(t),this.finishLabelCreation()}}},{key:"addPolygonLabel",value:function(e){var t=we.getActiveLabelNameIndex(),a=we.getActiveImageData(),n={id:Z()(),labelIndex:t,checked:!1,vertices:e},i=we.getActiveGroupIndex();a.groupList[i].labelPolygons.push(n),Ja.dispatch(P(a.id,a)),Ja.dispatch(w(!0)),Ja.dispatch(I(n.id))}},{key:"startExistingLabelResize",value:function(e,t,a){Ja.dispatch(I(t)),this.resizeAnchorIndex=a}},{key:"endExistingLabelResize",value:function(e){this.applyResizeToPolygonLabel(e),this.resizeAnchorIndex=null}},{key:"applyResizeToPolygonLabel",value:function(e){var t=this,a=we.getActiveImageData(),n=we.getActivePolygonLabel(),i=we.getActiveGroupIndex(),r=Object(Se.a)(a,function(r){r.groupList[i].labelPolygons=a.groupList[i].labelPolygons.map(function(a){return a.id!==n.id?a:Ve({},a,{vertices:a.vertices.map(function(a,n){if(n!==t.resizeAnchorIndex)return a;var i=W.snapPointToRect(e.mousePositionOnCanvas,e.activeImageRectOnCanvas);return Re.transferPointFromCanvasToImage(i,e)})})})});Ja.dispatch(P(a.id,r)),Ja.dispatch(I(n.id))}},{key:"discardSuggestedPoint",value:function(){this.suggestedAnchorIndexInPolygon=null,this.suggestedAnchorPositionOnCanvas=null}},{key:"addSuggestedAnchorToPolygonLabel",value:function(e){var t=this,a=we.getActiveImageData(),n=we.getActivePolygonLabel(),i=Re.transferPointFromCanvasToImage(this.suggestedAnchorPositionOnCanvas,e),r=we.getActiveGroupIndex(),o=Object(Se.a)(a,function(e){e.groupList[a.activeGroupIndex].labelPolygons=a.groupList[r].labelPolygons.map(function(e){return e.id!==n.id?e:Ve({},e,{vertices:(a=e.vertices,r=t.suggestedAnchorIndexInPolygon,o=i,[].concat(Object(Ue.a)(a.slice(0,r)),[o],Object(Ue.a)(a.slice(r))))});var a,r,o})});Ja.dispatch(P(o.id,o)),this.startExistingLabelResize(e,n.id,this.suggestedAnchorIndexInPolygon),this.discardSuggestedPoint()}},{key:"isInProgress",value:function(){return this.isCreationInProgress()||this.isResizeInProgress()}},{key:"isCreationInProgress",value:function(){return null!==this.activePath&&0!==this.activePath.length}},{key:"isResizeInProgress",value:function(){return null!==this.resizeAnchorIndex}},{key:"isMouseOverAnchor",value:function(e,t){return e&&t?W.isPointInside(W.getRectWithCenterAndSize(t,this.config.anchorSize),e):null}},{key:"isMouseOverLine",value:function(e,t){var a=this.config.anchorHoverSize.width/2,n=Math.min(t.start.x,t.end.x),i=Math.max(t.start.x,t.end.x),r=Math.min(t.start.y,t.end.y),o=Math.max(t.start.y,t.end.y);return n-a<=e.x&&i+a>=e.x&&r-a<=e.y&&o+a>=e.y&&Fe.getDistanceFromLine(t,e)<a}},{key:"mapPointsToLines",value:function(e){for(var t=[],a=0;a<e.length-1;a++)t.push({start:e[a],end:e[a+1]});return t}},{key:"mapPointsToAnchors",value:function(e){var t=this;return e.map(function(e){return W.getRectWithCenterAndSize(e,t.config.anchorSize)})}},{key:"getPolygonUnderMouse",value:function(e){for(var t=we.getActiveGroupIndex(),a=we.getActiveImageData().groupList[t].labelPolygons,n=0;n<a.length;n++){for(var i=Re.transferPolygonFromImageToCanvas(a[n].vertices,e),r=this.mapPointsToLines(i.concat(i[0])),o=0;o<r.length;o++)if(this.isMouseOverLine(e.mousePositionOnCanvas,r[o]))return a[n];for(var c=0;c<i.length;c++)if(this.isMouseOverAnchor(e.mousePositionOnCanvas,i[c]))return a[n]}return null}},{key:"getAnchorUnderMouse",value:function(e){for(var t=we.getActiveGroupIndex(),a=we.getActiveImageData().groupList[t].labelPolygons,n=0;n<a.length;n++)for(var i=Re.transferPolygonFromImageToCanvas(a[n].vertices,e),r=0;r<i.length;r++)if(this.isMouseOverAnchor(e.mousePositionOnCanvas,i[r]))return i[r];return null}}]),t}(ke),Xe=function(e){function t(e){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).call(this,e))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"mouseMoveHandler",value:function(e){}},{key:"mouseDownHandler",value:function(e){}},{key:"mouseUpHandler",value:function(e){}},{key:"render",value:function(e){}},{key:"drawImage",value:function(e,t){e&&this.canvas&&this.canvas.getContext("2d").drawImage(e,t.x,t.y,t.width,t.height)}},{key:"isInProgress",value:function(){return!1}}]),t}(ke);function Ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var Je=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"mountSupportRenderingEngine",value:function(e){switch(e){case V.RECTANGLE:Ie.supportRenderingEngine=new je(Ie.canvas);break;case V.POINT:Ie.supportRenderingEngine=new ze(Ie.canvas);break;case V.POLYGON:Ie.supportRenderingEngine=new We(Ie.canvas);break;default:Ie.supportRenderingEngine=null}}},{key:"swapSupportRenderingEngine",value:function(t){e.mountSupportRenderingEngine(t)}},{key:"mountRenderEngines",value:function(t){Ie.primaryRenderingEngine=new Xe(Ie.canvas),e.mountSupportRenderingEngine(t)}},{key:"fullRender",value:function(){Pe.clearCanvas(Ie.canvas),Ie.primaryRenderingEngine.drawImage(Ie.image,Ie.imageRectOnCanvas),Ie.primaryRenderingEngine.render(e.getEditorData()),Ie.supportRenderingEngine&&Ie.supportRenderingEngine.render(e.getEditorData())}},{key:"setLoadingStatus",value:function(e){Ie.isLoading=e}},{key:"setActiveImage",value:function(e){Ie.image=e}},{key:"getEditorData",value:function(e){return{mousePositionOnCanvas:Ie.mousePositionOnCanvas,canvasSize:Me.getSize(Ie.canvas),activeImageScale:Ie.imageScale,activeImageRectOnCanvas:Ie.imageRectOnCanvas,activeKeyCombo:at.getActiveCombo(),event:e}}},{key:"calculateImageRect",value:function(e){if(e){var t=g.CANVAS_PADDING_WIDTH_PX,a={x:0,y:0,width:e.width,height:e.height},n={x:t,y:t,width:Ie.canvas.width-2*t,height:Ie.canvas.height-2*t};return W.fitInsideRectWithRatio(n,W.getRatio(a))}return null}},{key:"calculateImageScale",value:function(e){return e&&Ie.imageRectOnCanvas?e.width/Ie.imageRectOnCanvas.width:null}},{key:"calculateAllCharacteristics",value:function(){Ie.imageRectOnCanvas=e.calculateImageRect(Ie.image),Ie.imageScale=e.calculateImageScale(Ie.image)}},{key:"updateMousePositionIndicator",value:function(e){if(!Ie.imageRectOnCanvas||!Ie.canvas)return Ie.mousePositionIndicator.style.display="none",void(Ie.cursor.style.display="none");var t=Me.getMousePositionOnCanvasFromEvent(e,Ie.canvas),a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ye(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ye(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({x:0,y:0},Me.getSize(Ie.canvas));if(!W.isPointInside(a,t))return Ie.mousePositionIndicator.style.display="none",void(Ie.cursor.style.display="none");if(W.isPointInside(Ie.imageRectOnCanvas,t)){var n=Ie.imageScale,i="x: "+Math.round((t.x-Ie.imageRectOnCanvas.x)*n)+", y: "+Math.round((t.y-Ie.imageRectOnCanvas.y)*n);Ie.mousePositionIndicator.innerHTML=i,Ie.mousePositionIndicator.style.left=t.x+15+"px",Ie.mousePositionIndicator.style.top=t.y+15+"px",Ie.mousePositionIndicator.style.display="block"}else Ie.mousePositionIndicator.style.display="none";Ie.cursor.style.left=t.x+"px",Ie.cursor.style.top=t.y+"px",Ie.cursor.style.display="block"}}]),e}();Je.resizeCanvas=function(e){e&&Ie.canvas&&(Ie.canvas.width=e.width,Ie.canvas.height=e.height)};var Ze=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getActions",value:function(){return this.actions}}]),e}();Ze.actions=[];var Ke=function e(){Object(d.a)(this,e)};Ke.mobileDeviceData=void 0,Ke.isMac=void 0,Ke.isSafari=void 0,Ke.isFirefox=void 0;var qe=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getPreviousImage",value:function(){var e=we.getActiveImageIndex();Ja.dispatch(y(e-1))}},{key:"getNextImage",value:function(){var e=we.getActiveImageIndex();Ja.dispatch(y(e+1))}},{key:"getImageByIndex",value:function(e){var t=we.getImagesData().length;e<0||e>t-1||Ja.dispatch(y(e))}}]),e}(),$e=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(f.a)(t,e),t}(Ze);$e.actions=[{keyCombo:["Enter"],action:function(e){if(Ie.supportRenderingEngine&&Ie.supportRenderingEngine.labelType===V.POLYGON){var t=Je.getEditorData();Ie.supportRenderingEngine.addLabelAndFinishCreation(t)}Je.fullRender()}},{keyCombo:["Escape"],action:function(e){Ie.supportRenderingEngine&&Ie.supportRenderingEngine.labelType===V.POLYGON&&Ie.supportRenderingEngine.cancelLabelCreation(),Je.fullRender()}},{keyCombo:Ke.isMac?["Meta","ArrowLeft"]:["Control","ArrowLeft"],action:function(e){qe.getPreviousImage()}},{keyCombo:Ke.isMac?["Meta","ArrowRight"]:["Control","ArrowRight"],action:function(e){qe.getNextImage()}}];var Qe=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getActivePopupType",value:function(){return Ja.getState().general.activePopupType}},{key:"getActiveContext",value:function(){return Ja.getState().general.activeContext}}]),e}(),et=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"close",value:function(){Ja.dispatch(be(null)),at.restoreCtx()}}]),e}(),tt=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(f.a)(t,e),t}(Ze);tt.actions=[{keyCombo:["Escape"],action:function(e){var t=Qe.getActivePopupType();g.CLOSEABLE_POPUPS.includes(t)&&et.close()}}];var at=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getActiveCombo",value:function(){return e.activeCombo}},{key:"init",value:function(){window.addEventListener("keydown",e.onDown),window.addEventListener("keyup",e.onUp)}},{key:"switchCtx",value:function(t){var a=Qe.getActiveContext();a!==t&&(e.contextHistory.push(a),e.updateCtx(t))}},{key:"updateCtx",value:function(t){var a;switch(Ja.dispatch((a=t,{type:p.UPDATE_CONTEXT,payload:{activeContext:a}})),t){case he.EDITOR:e.actions=$e.getActions();break;case he.POPUP:e.actions=tt.getActions();break;default:e.actions=[]}}},{key:"restoreCtx",value:function(){e.updateCtx(e.contextHistory.pop())}},{key:"onDown",value:function(t){var a=e.getKeyCodeFromEvent(t);e.isInCombo(a)||(e.addToCombo(a),e.execute(t))}},{key:"onUp",value:function(t){var a=e.getKeyCodeFromEvent(t);e.removeFromCombo(a)}},{key:"execute",value:function(t){for(var a=0;a<e.actions.length;a++){var n=e.actions[a];e.matchCombo(e.activeCombo,n.keyCombo)&&n.action(t)}}},{key:"isInCombo",value:function(t){return e.activeCombo.indexOf(t)>=0}},{key:"addToCombo",value:function(t){e.activeCombo.push(t)}},{key:"removeFromCombo",value:function(t){var a=e.activeCombo.indexOf(t);a>=0&&e.activeCombo.splice(a,1)}},{key:"getKeyCodeFromEvent",value:function(e){return e.key}},{key:"matchCombo",value:function(e,t){return Oe.isEmpty(Oe.xor(e,t))}}]),e}();at.activeCombo=[],at.actions=[],at.contextHistory=[];var nt,it=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).imagesListRef=void 0,a.updateListSize=function(){if(a.imagesListRef){var e=a.imagesListRef.getBoundingClientRect();a.setState({size:{width:e.width,height:e.height}})}},a.onClickHandler=function(e){var t=a.props.activeImageIndex;ee("/mark/sign/mark",{id:a.props.imagesData[t].fileData.name,point:JSON.stringify(a.props.imagesData[t].groupList)}).then(function(t){200!==t.status?X.store.addNotification({title:"\u670d\u52a1\u5668\u4fdd\u5b58\u51fa\u9519,\u8bf7\u8054\u7cfb\u5f00\u53d1\u4eba\u5458 @tuguang , @chaihang",message:t.message,type:"warning",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}}):(X.store.addNotification({message:"\u4fdd\u5b58\u6210\u529f",type:"success",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:500}}),a.props.updateActiveImageIndex(e),a.props.updateActiveLabelType(a.props.activeLabelType),a.props.updateActiveLabelId(null))})},a.renderImagePreview=function(e,t,n,i){return r.a.createElement(fe,{key:e,index:e,style:i,size:{width:150,height:150},isScrolling:t,isChecked:a.props.imagesData[e].groupList.some(function(e){return e.labelRects.length>0})||a.props.imagesData[e].groupList.some(function(e){return e.labelPoints.length>0})||a.props.imagesData[e].groupList.some(function(e){return e.labelPolygons.length>0}),imageData:a.props.imagesData[e],onClick:function(){return a.onClickHandler(e)},isSelected:a.props.activeImageIndex===e})},a.state={size:null},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.updateListSize(),window.addEventListener("resize",this.updateListSize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateListSize)}},{key:"render",value:function(){var e=this,t=this.state.size;return r.a.createElement("div",{className:"ImagesList",ref:function(t){return e.imagesListRef=t},onClick:function(){return at.switchCtx(he.LEFT_NAVBAR)}},!!t&&r.a.createElement(re,{size:t,childSize:{width:150,height:150},childCount:this.props.imagesData.length,childRender:this.renderImagePreview,overScanHeight:200}))}}]),t}(r.a.Component),rt={updateActiveImageIndex:y,updateActiveLabelId:I,updateActiveLabelType:L,updateLabelIndexByInfo:E,updateActiveGroupIndex:k,updateGroupList:D,addImageData:C},ot=Object(l.b)(function(e){return{activeImageIndex:e.editor.activeImageIndex,imagesData:e.editor.imagesData,activeLabelType:e.editor.imagesData[we.getActiveImageIndex()].groupList[we.getActiveGroupIndex()].activeLabelType}},rt)(it);a(180);!function(e){e.IMAGE_RECOGNITION="IMAGE_RECOGNITION",e.OBJECT_DETECTION="OBJECT_DETECTION"}(nt||(nt={}));var ct=[{labelType:V.NAME,headerText:"\u56fe\u50cf\u8bc6\u522b",imageSrc:"ico/object.png",imageAlt:"object"},{labelType:V.RECTANGLE,headerText:"\u77e9\u5f62",imageSrc:"ico/rectangle.png",imageAlt:"rectangle"},{labelType:V.POINT,headerText:"\u70b9",imageSrc:"ico/point.png",imageAlt:"point"},{labelType:V.POLYGON,headerText:"\u591a\u8fb9\u5f62",imageSrc:"ico/polygon.png",imageAlt:"polygon"}];a(181),a(182),a(183);function st(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}var lt=function(e){var t=e.size,a=e.padding,n=e.image,r=e.imageAlt,o=e.href,c=e.onClick,s=e.style,l=e.isActive,u=e.isDisabled,d=e.externalClassName,g=a||10,p=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?st(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):st(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},s,{width:t.width,height:t.height}),h={maxWidth:t.width-g,maxHeight:t.height-g};return i.createElement("div",{className:ce()("ImageButton",d,{active:l,disabled:u}),style:p,onClick:function(e){e.stopPropagation(),c&&c()}},!!o&&i.createElement("a",{href:o,style:h,target:"_blank",rel:"noopener noreferrer"},i.createElement("img",{draggable:!1,alt:r,src:n,style:h})),!o&&i.createElement("img",{draggable:!1,alt:r,src:n,style:h}))},ut=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).dropdownOptionHeight=30,a.dropdownOptionCount=6,a.dropdownMargin=4,a.dropdownLabel=void 0,a.dropdown=void 0,a.openDropdown=function(){a.setState({isOpen:!0}),window.addEventListener("mousedown",a.closeDropdown)},a.closeDropdown=function(e){var t={x:e.clientX,y:e.clientY},n=a.dropdown.getBoundingClientRect(),i={x:n.left,y:n.top,width:n.width,height:n.height};W.isPointInside(i,t)||(a.setState({isOpen:!1}),window.removeEventListener("mousedown",a.closeDropdown))},a.getDropdownStyle=function(){var e=a.dropdownLabel.getBoundingClientRect(),t=Math.min(a.props.options.length,a.dropdownOptionCount)*a.dropdownOptionHeight,n={width:e.width,height:t,left:e.left};return 2*window.innerHeight/3<e.top?Object.assign(n,{top:e.top-a.dropdownMargin-t}):Object.assign(n,{top:e.bottom+a.dropdownMargin})},a.getDropdownOptions=function(){return a.props.options.map(function(e,t){return r.a.createElement("div",{className:"DropdownOption",key:e,style:{height:a.dropdownOptionHeight},onClick:function(e){return function(e,t){a.setState({isOpen:!1}),window.removeEventListener("mousedown",a.closeDropdown),a.props.onSelectLabel(a.props.id,e),a.props.updateHighlightedLabelId(null),a.props.updateActiveLabelId(a.props.id),a.props.findNextAvailableLabelIndex(),t.stopPropagation()}(t,e)}},e)})},a.mouseEnterHandler=function(){a.props.updateHighlightedLabelId(a.props.id)},a.mouseLeaveHandler=function(){a.props.updateHighlightedLabelId(null)},a.onClickHandler=function(){a.props.updateActiveLabelId(a.props.id)},a.state={animate:!1,isOpen:!1},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;requestAnimationFrame(function(){e.setState({animate:!0})})}},{key:"getClassName",value:function(){return ce()("LabelInputField",{loaded:this.state.animate,active:this.props.isActive,highlighted:this.props.isHighlighted})}},{key:"render",value:function(){var e=this,t=this.props,a=t.size,n=t.id,i=t.value,o=t.onDelete,c=t.onCheck,s=t.checked;return r.a.createElement("div",{className:this.getClassName(),style:{width:a.width,height:a.height},key:n,onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler,onClick:this.onClickHandler},r.a.createElement("div",{className:"LabelInputFieldWrapper",style:{width:a.width,height:a.height}},r.a.createElement("div",{className:"Marker"}),r.a.createElement("div",{className:"Content"},r.a.createElement("div",{className:"ContentWrapper"},r.a.createElement("div",{className:"DropdownLabel",ref:function(t){return e.dropdownLabel=t},onClick:this.openDropdown},i||"\u9009\u62e9\u4e00\u4e2a\u6807\u7b7e"),this.state.isOpen&&r.a.createElement("div",{className:"Dropdown",style:this.getDropdownStyle(),ref:function(t){return e.dropdown=t}},r.a.createElement(G.a,null,r.a.createElement("div",null,this.getDropdownOptions())))),r.a.createElement("span",{className:"describeText"},"\u88ab\u906e\u6321"),r.a.createElement("input",{type:"checkbox",onClick:function(){return c(n)},checked:s,onChange:function(){}}),r.a.createElement("div",{className:"ContentWrapper"},r.a.createElement(lt,{externalClassName:"trash",image:"ico/trash.png",imageAlt:"remove_rect",size:{width:30,height:30},onClick:function(){return o(n)}})))))}}]),t}(r.a.Component),dt={updateHighlightedLabelId:A,updateActiveLabelId:I,findNextAvailableLabelIndex:N},gt=Object(l.b)(function(e){return{}},dt)(ut),pt=(a(184),Object(l.b)(function(e){return{firstLabelCreatedFlag:we.getFirstLabelCreatedFlag()}},{})(function(e){var t=e.firstLabelCreatedFlag,a=e.labelBefore,n=e.labelAfter,i=r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,alt:"lets_start",src:"img/rocket.png"}),r.a.createElement("p",{className:"extraBold"},a)),o=r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,alt:"no_labels",src:"img/box-opened.png"}),r.a.createElement("p",{className:"extraBold"},n));return r.a.createElement("div",{className:"EmptyLabelList"},t?o:i)}));function ht(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function mt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ht(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ht(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var vt={updateImageDataById:P,updateActiveLabelNameIndex:O,updateActiveLabelId:I},ft=Object(l.b)(function(e){return{activeLabelId:we.getActiveLabelId(),highlightedLabelId:we.getHighlightedLabelId(),labelNames:e.editor.labelNames}},vt)(function(e){var t=e.size,a=e.imageData,n=e.updateImageDataById,i=e.labelNames,o=e.updateActiveLabelNameIndex,c=e.activeLabelId,s=e.highlightedLabelId,l=e.updateActiveLabelId,u=we.getActiveImageData().groupList[we.getActiveGroupIndex()].labelRects,d={width:t.width,height:t.height},g={width:t.width,height:40*u.length},p=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelRects=u.filter(function(t){return t.id!==e})});n(a.id,t)},h=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelRects=u.map(function(t){return t.id!==e?t:mt({},t,{checked:!t.checked})})});n(a.id,t)},m=function(e,t){var i=Object(Se.a)(a,function(n){n.groupList[a.activeGroupIndex].labelRects=u.map(function(a){return a.id===e?mt({},a,{labelIndex:t}):a})});n(a.id,i),o(t)};return r.a.createElement("div",{className:"RectLabelsList",style:d,onClickCapture:function(){l(null)}},0===u.length?r.a.createElement(pt,{labelBefore:"\u6807\u8bb0\u7b2c\u4e00\u4e2a\u77e9\u5f62",labelAfter:"\u8fd9\u5f20\u56fe\u7247\u8fd8\u6ca1\u6709\u6807\u6ce8"}):r.a.createElement(G.a,null,r.a.createElement("div",{className:"RectLabelsListContent",style:g},u.map(function(e,a){return r.a.createElement(gt,{size:{width:t.width,height:40},isActive:e.id===c,index:a,isHighlighted:e.id===s,id:e.id,key:e.id,onDelete:p,onCheck:h,value:null!==e.labelIndex?i[e.labelIndex]:null,options:i,onSelectLabel:m,checked:e.checked})}))))});a(185);function bt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function yt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bt(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Ot={updateImageDataById:P,updateActiveLabelNameIndex:O,updateActiveLabelId:I,findNextAvailableLabelIndex:N},Et=Object(l.b)(function(e){return{activeLabelId:we.getActiveLabelId(),highlightedLabelId:we.getHighlightedLabelId(),labelNames:e.editor.labelNames}},Ot)(function(e){var t=e.size,a=e.imageData,n=e.updateImageDataById,i=e.labelNames,o=e.updateActiveLabelNameIndex,c=e.activeLabelId,s=e.highlightedLabelId,l=e.updateActiveLabelId,u=e.findNextAvailableLabelIndex,d=we.getActiveImageData().groupList[we.getActiveGroupIndex()].labelPoints,g={width:t.width,height:t.height},p={width:t.width,height:40*d.length},h=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelPoints=d.filter(function(t){return t.id!==e})});n(a.id,t),u()},m=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelPoints=d.map(function(t){return t.id!==e?t:yt({},t,{checked:!t.checked})})});n(a.id,t)},v=function(e,t){var i=!1,r=Object(Se.a)(a,function(n){n.groupList[a.activeGroupIndex].labelPoints=d.map(function(r){return r.id===e?n.groupList[a.activeGroupIndex].labelPoints.some(function(e){return e.labelIndex===t})?(X.store.addNotification({message:"\u5df2\u7ecf\u6807\u8bb0\u8fc7\u8fd9\u4e2a\u90e8\u4f4d\u4e86",type:"warning",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}}),i=!0,r):yt({},r,{labelIndex:t}):r})});n(a.id,r),!i&&o(t)};return r.a.createElement("div",{className:"PointLabelsList",style:g,onClickCapture:function(){l(null)}},0===d.length?r.a.createElement(pt,{labelBefore:"\b\u6807\u8bb0\u7b2c\u4e00\u4e2a\u70b9",labelAfter:"\u8fd9\u5f20\u56fe\u7247\u8fd8\u6ca1\u6709\u6807\u6ce8"}):r.a.createElement(G.a,null,r.a.createElement("div",{className:"PointLabelsListContent",style:p},d.map(function(e,a){return r.a.createElement(gt,{size:{width:t.width,height:40},isActive:e.id===c,isHighlighted:e.id===s,id:e.id,key:e.id,onDelete:h,value:null!==e.labelIndex?i[e.labelIndex]:null,options:i,onSelectLabel:v,onCheck:m,checked:e.checked,index:a})}))))});a(186);function It(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function At(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?It(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):It(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Lt={updateImageDataById:P,updateActiveLabelNameIndex:O,updateActiveLabelId:I},Pt=Object(l.b)(function(e){return{activeLabelId:we.getActiveLabelId(),highlightedLabelId:we.getHighlightedLabelId(),labelNames:e.editor.labelNames}},Lt)(function(e){var t=e.size,a=e.imageData,n=e.updateImageDataById,i=e.labelNames,o=e.updateActiveLabelNameIndex,c=e.activeLabelId,s=e.highlightedLabelId,l=e.updateActiveLabelId,u=we.getActiveImageData().groupList[we.getActiveGroupIndex()].labelPolygons,d={width:t.width,height:t.height},g={width:t.width,height:40*u.length},p=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelPolygons=u.filter(function(t){return t.id!==e})});n(a.id,t)},h=function(e){var t=Object(Se.a)(a,function(t){t.groupList[a.activeGroupIndex].labelPolygons=u.map(function(t){return t.id!==e?t:At({},t,{checked:!t.checked})})});n(a.id,t)},m=function(e,t){var i=Object(Se.a)(a,function(n){n.groupList[a.activeGroupIndex].labelPolygons=u.map(function(a){return a.id===e?At({},a,{labelIndex:t}):a})});n(a.id,i),o(t)};return r.a.createElement("div",{className:"PolygonLabelsList",style:d,onClickCapture:function(){l(null)}},0===u.length?r.a.createElement(pt,{labelBefore:"\u6807\u6ce8\u7b2c\u4e00\u4e2a\u591a\u8fb9\u5f62",labelAfter:"\u8fd9\u5f20\u56fe\u7247\u8fd8\u6ca1\u6709\u6807\u6ce8"}):r.a.createElement(G.a,null,r.a.createElement("div",{className:"PolygonLabelsListContent",style:g},u.map(function(e,a){return r.a.createElement(gt,{size:{width:t.width,height:40},isActive:e.id===c,isHighlighted:e.id===s,id:e.id,index:a,key:e.id,onDelete:p,value:null!==e.labelIndex?i[e.labelIndex]:null,options:i,onSelectLabel:m,onCheck:h,checked:e.checked})}))))}),Ct=(a(187),function(e){var t=e.key,a=e.label,n=e.onClick,r=e.style,o=e.isActive,c=e.isDisabled,s=e.externalClassName;return i.createElement("div",{className:ce()("TextButton",s,{active:o,disabled:c}),onClick:function(e){e.stopPropagation(),n&&n()},key:t,style:r},a)}),Tt=function(e){function t(e){var a;Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).labelsToolkitRef=void 0,a.tabs=void 0,a.updateToolkitSize=function(){if(a.labelsToolkitRef){var e=a.labelsToolkitRef.getBoundingClientRect();a.setState({size:{width:e.width,height:e.height}})}},a.headerClickHandler=function(e){a.setState({activeLabelType:e}),a.props.updateActiveLabelType(e),a.props.updateActiveLabelId(null)},a.renderChildren=function(e){var t=a.state,n=t.activeLabelType,i=t.size,o=a.props,c=o.activeImageIndex,s=o.imagesData,l=o.activeGroupIndex;return a.tabs.reduce(function(t,o,u){var d=o===n&&l===e,p=Oe.find(ct,{labelType:o}),h=function(e){return ce()(e,{active:d})},m=r.a.createElement("div",{key:"Header_"+u,className:h("Header"),onClick:function(){return a.headerClickHandler(o)},style:{height:g.TOOLKIT_TAB_HEIGHT_PX}},r.a.createElement("div",{className:"Marker"}),r.a.createElement("div",{className:"HeaderGroupWrapper"},r.a.createElement("img",{draggable:!1,className:"Ico",src:p.imageSrc,alt:p.imageAlt}),p.headerText),r.a.createElement("div",{className:"HeaderGroupWrapper"},r.a.createElement("img",{draggable:!1,className:"Arrow",src:"ico/down.png",alt:"down_arrow"}))),v=r.a.createElement("div",{key:"Content_"+u,className:h("Content"),style:{height:d?300:0}},o===V.RECTANGLE&&r.a.createElement(ft,{size:{width:i.width-20,height:280},imageData:s[c]}),o===V.POINT&&r.a.createElement(Et,{size:{width:i.width-20,height:280},imageData:s[c]}),o===V.POLYGON&&r.a.createElement(Pt,{size:{width:i.width-20,height:280},imageData:s[c]}));return t.push([m,v]),t},[])},a.buttonOnClickHandle=function(){a.props.updateGroupList("group-".concat(a.props.groupList.length+1))},a.renderChildrenWrapper=function(){var e=a.props,t=e.groupList,n=e.activeGroupIndex;return t.map(function(e,t){return r.a.createElement("div",{className:"LabelsToolkitWrapper",key:"LabelsToolkitWrapper_"+t},r.a.createElement("div",{className:t===n?"active pDiv":"pDiv",onClick:function(){a.props.updateActiveGroupIndex(t),a.headerClickHandler(a.state.activeLabelType)}},"person-"+t,t!==n?r.a.createElement(Ct,{label:"\u5220\u9664",externalClassName:"buttonClass",onClick:function(){return a.props.deleteGroupList(t)}}):null),t===n&&a.renderChildren(t))}).concat(r.a.createElement("div",{className:"addButton",key:"button"},r.a.createElement("button",{style:{width:"30%"},onClick:a.buttonOnClickHandle},"\u6dfb\u52a0 +"," ")))},a.tabs=e.projectType===nt.IMAGE_RECOGNITION?[V.NAME]:[V.RECTANGLE,V.POINT,V.POLYGON];var n=e.activeLabelType?e.activeLabelType:a.tabs[0];return a.state={size:null,activeLabelType:n},e.updateActiveLabelType(n),a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.updateToolkitSize(),window.addEventListener("resize",this.updateToolkitSize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateToolkitSize)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"LabelsToolkit",ref:function(t){return e.labelsToolkitRef=t},onClick:function(){return at.switchCtx(he.RIGHT_NAVBAR)}},r.a.createElement(G.a,null,this.state.size&&this.renderChildrenWrapper()))}}]),t}(r.a.Component),xt={updateImageDataById:P,updateActiveLabelType:L,updateActiveLabelId:I,updateGroupList:D,updateActiveGroupIndex:k,deleteGroupList:function(e){return{type:p.DELETE_GROUP_LIST,payload:{groupIndex:e}}}},wt=Object(l.b)(function(e){return{activeImageIndex:e.editor.activeImageIndex,activeLabelType:we.getActiveLabelType(),imagesData:e.editor.imagesData,projectType:e.editor.projectType,groupList:we.getActiveImageData().groupList,activeGroupIndex:we.getActiveGroupIndex()}},xt)(Tt),Dt=(a(188),function(e){var t=e.direction,a=e.isOpen,i=e.isWithContext,o=e.renderContent,c=e.renderCompanion;return r.a.createElement("div",{className:ce()("SideNavigationBar",{left:t===n.LEFT,right:t===n.RIGHT,"with-context":i,closed:!a})},r.a.createElement("div",{className:"CompanionBar"},c&&c()),a&&r.a.createElement("div",{className:"NavigationBarContentWrapper"},o&&o()))}),kt=(a(189),function(e){var t=e.key,a=e.label,n=e.onClick,r=e.style,o=e.isActive,c=e.isDisabled,s=e.image,l=e.imageAlt;return i.createElement("div",{className:ce()("VerticalEditorButton",{active:o,disabled:c}),onClick:n||void 0,key:t,style:r},s&&i.createElement("img",{draggable:!1,alt:l,src:s}),a)}),Nt=(a(190),a(191),function e(){Object(d.a)(this,e)});Nt.getIndicator=function(e){switch(e){case Ae.ADD:return"ico/plus.png";case Ae.RESIZE:return"ico/resize.png";case Ae.CLOSE:return"ico/close.png";case Ae.MOVE:return"ico/move.png";case Ae.CANCEL:return"ico/cancel.png";default:return null}},Nt.getCursorStyle=function(e){return ce()("Cursor",{move:e===Ae.MOVE,add:e===Ae.ADD,resize:e===Ae.RESIZE,close:e===Ae.CLOSE,cancel:e===Ae.CANCEL})};var Rt,St=function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(i)))).loadImage=function(){var e=Object(_.a)(S.a.mark(function e(t){var n;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.loadStatus?(Je.setActiveImage(ue.getById(t.id)),a.updateModelAndRender()):Ie.isLoading||(Je.setLoadingStatus(!0),n=function(e){return a.saveLoadedImage(e,t)},de.loadImage(t.fileData,n,a.handleLoadImageError));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.saveLoadedImage=function(e,t){var n=Object(Se.a)(t,function(e){e.loadStatus=!0});a.props.updateImageDataById(t.id,n),ue.store(n.id,e),Je.setActiveImage(e),Je.setLoadingStatus(!1),a.updateModelAndRender()},a.handleLoadImageError=function(){console.log("handleLoadImageError")},a.updateModelAndRender=function(){Je.resizeCanvas(a.props.size),Je.calculateAllCharacteristics(),Je.fullRender()},a.update=function(e){var t=Je.getEditorData(e);Ie.mousePositionOnCanvas=Me.getMousePositionOnCanvasFromEvent(e,Ie.canvas),Ie.primaryRenderingEngine.update(t),Ie.supportRenderingEngine&&Ie.supportRenderingEngine.update(t),!a.props.activePopupType&&Je.updateMousePositionIndicator(e),Je.fullRender()},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.mountEventListeners();var e=this.props,t=e.imageData,a=e.activeLabelType;at.switchCtx(he.EDITOR),Je.mountRenderEngines(a),le.addAndRun(this.loadImage(t))}},{key:"componentWillUnmount",value:function(){this.unmountEventListeners()}},{key:"componentDidUpdate",value:function(e,t,a){var n=this.props,i=n.imageData,r=n.activeLabelType;e.imageData.id!==i.id&&le.addAndRun(this.loadImage(i)),e.activeLabelType!==r&&Je.swapSupportRenderingEngine(r),this.updateModelAndRender()}},{key:"mountEventListeners",value:function(){window.addEventListener(xe.MOUSE_MOVE,this.update),window.addEventListener(xe.MOUSE_UP,this.update),Ie.canvas.addEventListener(xe.MOUSE_DOWN,this.update)}},{key:"unmountEventListeners",value:function(){window.removeEventListener(xe.MOUSE_MOVE,this.update),window.removeEventListener(xe.MOUSE_UP,this.update),Ie.canvas.removeEventListener(xe.MOUSE_DOWN,this.update)}},{key:"render",value:function(){return r.a.createElement("div",{className:"Editor"},r.a.createElement("canvas",{className:"ImageCanvas",ref:function(e){return Ie.canvas=e},draggable:!1,onContextMenu:function(e){return e.preventDefault()}}),r.a.createElement("div",{className:"MousePositionIndicator",ref:function(e){return Ie.mousePositionIndicator=e},draggable:!1}),r.a.createElement("div",{className:Nt.getCursorStyle(this.props.customCursorStyle),ref:function(e){return Ie.cursor=e},draggable:!1},r.a.createElement("img",{draggable:!1,alt:"indicator",src:Nt.getIndicator(this.props.customCursorStyle)})))}}]),t}(r.a.Component),_t={updateImageDataById:P,loadDataFromLocalStorge:function(){return{type:p.LOAD_DATA_FROM_LOCALSTORGE}}},jt=Object(l.b)(function(e){return{activeLabelType:e.editor.imagesData[we.getActiveImageIndex()].groupList[we.getActiveGroupIndex()].activeLabelType||V.POINT,activePopupType:e.general.activePopupType,activeLabelId:e.editor.imagesData[we.getActiveImageIndex()].groupList[we.getActiveGroupIndex()].activeLabelId,customCursorStyle:e.general.customCursorStyle}},_t)(St),Mt=(a(192),{updateActiveImageIndex:y}),Gt=Object(l.b)(function(e){return{activeImageIndex:e.editor.activeImageIndex,activeContext:e.general.activeContext}},Mt)(function(e){var t=e.size,a=e.imageData,n=e.totalImageCount,i=e.activeImageIndex,o=e.activeContext,c=e.updateActiveImageIndex;return r.a.createElement("div",{className:ce()("BottomNavigationBar",{"with-context":o===he.EDITOR})},r.a.createElement(lt,{image:"ico/left.png",imageAlt:"previous",size:{width:25,height:25},onClick:function(){i>0&&c(i-1)},isDisabled:0===i,externalClassName:"left"}),t.width>400?r.a.createElement("div",{className:"CurrentImageName"}," ",a.fileData.name," "):r.a.createElement("div",{className:"CurrentImageCount"}," ",i+1+" / "+n," "),r.a.createElement(lt,{image:"ico/right.png",imageAlt:"next",size:{width:25,height:25},onClick:function(){i<n-1&&c(i+1)},isDisabled:i===n-1,externalClassName:"right"}))}),Bt={updateGroupList:D,updateActiveGroupIndex:k,updateActiveLabelNameIndex:O,updateLabelIndexByInfo:E,updateActiveImageIndex:y},zt=Object(l.b)(function(e){return{windowSize:e.general.windowSize,activeImageIndex:e.editor.activeImageIndex,imagesData:e.editor.imagesData,activeContext:e.general.activeContext,editor:e.editor}},Bt)(function(e){var t=e.windowSize,a=e.activeImageIndex,o=e.imagesData,c=e.activeContext,l=(e.editor,e.updateGroupList,e.updateActiveGroupIndex,e.updateLabelIndexByInfo,Object(i.useState)(!0)),u=Object(s.a)(l,2),d=u[0],p=u[1],h=Object(i.useState)(!0),m=Object(s.a)(h,2),v=m[0],f=m[1],b=function(){if(t){var e=d?g.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX:g.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX,a=v?g.SIDE_NAVIGATION_BAR_WIDTH_OPEN_PX:g.SIDE_NAVIGATION_BAR_WIDTH_CLOSED_PX;return{width:t.width-e-a,height:t.height-g.TOP_NAVIGATION_BAR_HEIGHT_PX-g.BOTTOM_NAVIGATION_BAR_HEIGHT_PX}}return null},y=function(){d?d&&c===he.LEFT_NAVBAR&&at.restoreCtx():at.switchCtx(he.LEFT_NAVBAR),p(!d)},O=function(){v?v&&c===he.RIGHT_NAVBAR&&at.restoreCtx():at.switchCtx(he.RIGHT_NAVBAR),f(!v)};return Object(i.useEffect)(function(){},[]),r.a.createElement("div",{className:"EditorContainer"},r.a.createElement(Dt,{direction:n.LEFT,isOpen:d,isWithContext:c===he.LEFT_NAVBAR,renderCompanion:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(kt,{label:"Images",image:"/ico/files.png",imageAlt:"images",onClick:y,isActive:d}))},renderContent:function(){return r.a.createElement(ot,null)}}),r.a.createElement("div",{className:"EditorWrapper",onMouseDown:function(){return at.switchCtx(he.EDITOR)}},r.a.createElement(jt,{size:b(),imageData:o[a]}),r.a.createElement(Gt,{imageData:o[a],size:b(),totalImageCount:o.length})),r.a.createElement(Dt,{direction:n.RIGHT,isOpen:v,isWithContext:c===he.RIGHT_NAVBAR,renderCompanion:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(kt,{label:"Labels",image:"/ico/tags.png",imageAlt:"labels",onClick:O,isActive:v}))},renderContent:function(){return r.a.createElement(wt,null)}}))}),Ut=(a(193),a(194),Object(l.b)(function(e){return{imagesData:e.editor.imagesData,activeLabelType:we.getActiveLabelType()}},{})(function(e){var t=e.imagesData,a=e.activeLabelType,n=t.reduce(function(e,t){return e+(t.groupList[t.activeGroupIndex].labelPoints.length>0?1:0)},0),i=t.reduce(function(e,t){return e+(t.groupList[t.activeGroupIndex].labelRects.length>0?1:0)},0),o=t.reduce(function(e,t){return e+(t.groupList[t.activeGroupIndex].labelPolygons.length>0?1:0)},0);return r.a.createElement("div",{className:"StateBar"},r.a.createElement("div",{style:{width:function(){switch(a){case V.POINT:return 100*n/t.length;case V.RECTANGLE:return 100*i/t.length;case V.POLYGON:return 100*o/t.length;default:return 0}}()+"%"},className:"done"}))})),Ft=(a(195),function(e){var t=e.under,a=e.over,n=e.active,i=e.key,o=e.label,c=e.onClick,s=e.style;return r.a.createElement("div",{className:ce()("UnderlineTextButton",{under:t,over:a,active:n}),onClick:c||void 0,key:i,style:s},o)}),Ht=(a(196),function(e){var t=e.key,a=e.label,n=e.isPassword,i=e.onChange,o=e.onFocus,c=e.inputStyle,s=e.labelStyle,l=e.barStyle,u=e.value;return r.a.createElement("div",{className:"TextInput"},r.a.createElement("input",{value:u||void 0,type:n?"password":"text",id:t,style:c,onChange:i||void 0,onFocus:o||void 0}),!!a&&r.a.createElement("label",{htmlFor:t,style:s},a),r.a.createElement("div",{className:"Bar",style:l}))}),Vt={updateActivePopupType:be,updateProjectName:function(e){return{type:p.UPDATE_PROJECT_NAME,payload:{projectName:e}}},updateImageData:T,updateActiveImageIndex:y,updateProjectType:b},Wt=Object(l.b)(function(e){return{projectName:e.editor.projectName}},Vt)(function(e){var t=e.updateActivePopupType,a=e.updateProjectName,n=e.projectName,i=e.updateImageData,o=e.updateActiveImageIndex,c=e.updateProjectType;return r.a.createElement("div",{className:"TopNavigationBar"},r.a.createElement(Ut,null),r.a.createElement("div",{className:"TopNavigationBarWrapper"},r.a.createElement("div",null,r.a.createElement("div",{className:"Header"})),r.a.createElement("div",{className:"NavigationBarGroupWrapper"},r.a.createElement("div",{className:"ProjectName"},"\u9879\u76ee\u540d\u79f0:"),r.a.createElement(Ht,{key:"ProjectName",isPassword:!1,value:n,onChange:function(e){var t=e.target.value.toLowerCase().replace(" ","-");a(t)},onFocus:function(e){e.target.setSelectionRange(0,e.target.value.length)}})),r.a.createElement("div",{className:"NavigationBarGroupWrapper"},r.a.createElement(Ft,{label:"\u8fd4\u56de\u6587\u4ef6\u5939",under:!0,onClick:function(){return i([]),o(0),void c(null)}}),r.a.createElement(Ft,{label:"\u5bfc\u5165\u66f4\u591a\u56fe\u7247",under:!0,onClick:function(){return t(u.LOAD_IMAGES)}}),r.a.createElement(Ft,{label:"\u5bfc\u51fa\u6807\u6ce8",under:!0,onClick:function(){return t(u.EXPORT_LABELS)}}))))}),Xt=Object(l.b)(function(e){return{activePopupType:e.general.activePopupType}})(function(e){var t=e.activePopupType;return r.a.createElement("div",{className:ce()("EditorView",{withPopup:!!t})},r.a.createElement(Wt,null),r.a.createElement(zt,null))}),Yt=(a(197),[{displayName:"Github",imageSrc:"/img/github-logo.png",imageAlt:"GitHub Logo",href:g.GITHUB_URL,tooltipMessage:"Show me some love on GitHub"},{displayName:"Medium",imageSrc:"/img/medium-logo.png",imageAlt:"Medium Logo",href:g.MEDIUM_URL,tooltipMessage:"Read my AI content on Medium"},{displayName:"Patreon",imageSrc:"/img/patreon-logo.png",imageAlt:"Patreon Logo",href:g.PATREON_URL,tooltipMessage:"Support MakeSense on Patreon and help it grow"}]),Jt=[{displayText:"\u4e0d\u9700\u8981\u989d\u5916\u5b89\u88c5\uff0c\u4ec5\u4ec5\u6253\u5f00\u6d4f\u89c8\u5668\u5c31\u53ef\u4ee5\u5f00\u59cb\u5de5\u4f5c",imageSrc:"img/online.png",imageAlt:"online"},{displayText:"\u6211\u4eec\u4e0d\u5b58\u50a8\u4f60\u7684\u56fe\u7247",imageSrc:"img/private.png",imageAlt:"private"},{displayText:"\u652f\u6301\u70b9\u3001\u77e9\u5f62\u3001\u591a\u8fb9\u5f62\u6807\u6ce8",imageSrc:"img/labels.png",imageAlt:"labels"},{displayText:"\u652f\u6301\u5bfc\u51fa\u6807\u6ce8\u6570\u636e",imageSrc:"img/file.png",imageAlt:"file"},{displayText:"\u652f\u6301\u88c1\u526a\u548c\u8c03\u6574\u5927\u5c0f",imageSrc:"img/crop.png",imageAlt:"crop"}],Zt=a(284),Kt=(a(283),a(133)),qt=a.n(Kt),$t=(a(198),a(199),a(200),function(e){var t=e.title,a=e.renderContent,n=e.acceptLabel,o=e.onAccept,c=e.skipAcceptButton,l=e.disableAcceptButton,u=e.rejectLabel,d=e.onReject,g=e.skipRejectButton,p=e.disableRejectButton,h=e.onClickUpload,m=e.isUpload,v=e.isLogin,f=e.onClickBack,b=Object(i.useState)(!1),y=Object(s.a)(b,2),O=y[0],E=y[1];Object(i.useEffect)(function(){O||(at.switchCtx(he.POPUP),E(!0))},[O]);return r.a.createElement("div",{className:"GenericYesNoPopup"},r.a.createElement("div",{className:"Header"},t),r.a.createElement("div",{className:"Content"},a()),m?r.a.createElement("div",{className:"Footer"},r.a.createElement(Ct,{label:"\u8fd4\u56de",onClick:f,externalClassName:"accept"})):r.a.createElement("div",{className:"Footer"},v&&r.a.createElement(Ct,{label:"\u4e0a\u4f20\u56fe\u7247",onClick:h,externalClassName:"accept"}),!g&&r.a.createElement(Ct,{label:u||"\u4e0d, \u8c22\u8c22",onClick:d,externalClassName:"reject",isDisabled:p}),!c&&r.a.createElement(Ct,{label:n||"\u597d\u7684",onClick:o,externalClassName:"accept",isDisabled:l})))}),Qt=a(131),ea=a.n(Qt),ta=a(132),aa=a.n(ta),na={updateActiveLabelNameIndex:O,updateLabelNamesList:x,updateProjectType:b,updateActiveImageIndex:y,updateImageData:T,updateFirstLabelCreatedFlag:w,addImageData:C,updateActivePopupType:be},ia=Object(l.b)(function(e){return{}},na)(function(e){e.updateActiveLabelNameIndex,e.updateLabelNamesList;var t=e.updateProjectType,n=e.updateActiveImageIndex,o=(e.updateImageData,e.updateFirstLabelCreatedFlag,e.addImageData),c=e.updateActivePopupType,l=ea()(),d=l.openModal,g=l.closeModal,p=l.isOpen,h=l.Modal,m=Object(K.b)(["token"]),v=Object(s.a)(m,3),f=v[0],b=v[1],y=v[2],O=Object(i.useState)(""),E=Object(s.a)(O,2),I=E[0],A=E[1],L=Object(i.useState)(""),P=Object(s.a)(L,2),C=P[0],T=P[1],x=Object(i.useState)(!1),w=Object(s.a)(x,2),D=w[0],k=w[1],N=Object(i.useState)(!1),R=Object(s.a)(N,2),j=R[0],G=R[1],B=Object(i.useState)([]),z=Object(s.a)(B,2),U=z[0],F=z[1],H=Object(i.useState)([]),W=Object(s.a)(H,2),Y=W[0],J=W[1],ae=Object(i.useState)([]),ne=Object(s.a)(ae,2),ie=ne[0],re=ne[1],oe=Object(i.useState)(""),ce=Object(s.a)(oe,2),se=ce[0],le=ce[1],ue=Object(i.useState)(!1),de=Object(s.a)(ue,2),ge=de[0],pe=de[1],he=Object(i.useState)({dir:"",userId:0}),me=Object(s.a)(he,2),ve=me[0],fe=me[1],be=Object(i.useState)(""),ye=Object(s.a)(be,2),Oe=ye[0],Ee=ye[1],Ie=Object(i.useState)(""),Ae=Object(s.a)(Ie,2),Le=Ae[0],Pe=Ae[1],Ce=Object(i.useState)(!1),Te=Object(s.a)(Ce,2),xe=Te[0],we=Te[1],De=Object(i.useRef)(),ke=function(e){A(e.target.value)},Ne=function(e){T(e.target.value)};Object(i.useEffect)(function(){Re()},[]);var Re=function(){f.token&&te("/mark/sign/getDir").then(function(e){if(200===e.status){var t=e.data.reduce(function(e,t){return t.list?[].concat(Object(Ue.a)(e),Object(Ue.a)(t.list)):Object(Ue.a)(e)},[]);F(t),k(!0)}else y("token")})},Se=function(e){var t,a,n=new FormData;n.append("dir",ve.dir),n.append("userId",ve.userId+""),[].slice.call(e).forEach(function(e,t){n.append("files",e)}),e.length&&we(!0),(t="/mark/sign/upload",a=n,fetch(q+t,{body:a,headers:{Authorization:$.get("token")},method:"POST"}).then(function(e){return e.json()})).then(function(e){200===e.status&&(console.log("success",e),we(!1))})},_e=function(e){Pe(e.target.value)},je=function(e){b("dirName",e),b("pageNo",1),b("pageSize",10),le(e),ee("/mark/sign/picList",{dir:e,pageNo:1,pageSize:10}).then(function(e){200===e.status&&Me(e.data.rows)})},Me=function(e){var t=[],a=0;pe(!1),e.forEach(function(){var n=Object(_.a)(S.a.mark(function n(i,r){var c,s,l;return S.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Q("get",i.url);case 2:c=n.sent,s=new File([c],i.id),(l=new FileReader).onabort=function(){return console.log("file reading was aborted")},l.onerror=function(){return console.log("file reading has failed")},l.onload=function(){var n=new Image;n.src=l.result,n.onload=function(n){s.width=this.width,s.height=this.height;var r=i.point?JSON.parse(i.point):[{activeLabelNameIndex:0,activeLabelType:V.POINT,activeLabelId:null,highlightedLabelId:null,firstLabelCreatedFlag:!1,labelRects:[],labelPoints:[],labelPolygons:[]}],c={activeGroupIndex:0,fileData:s,groupList:r,id:Z()(),loadStatus:!1};t.push(c),++a===e.length&&(t.sort(function(e,t){return+e.fileData.name-+t.fileData.name}),o(t,!0),pe(!0))}},l.readAsDataURL(s);case 9:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())},Ge=function(){G(!0),te("/mark/sign/getDir").then(function(e){if(200===e.status){var t=e.data;J(t)}})};return r.a.createElement(r.a.Fragment,null,r.a.createElement($t,{title:D?"\u9009\u62e9\u6587\u4ef6\u5939":"\u767b\u5f55",renderContent:j?function(){return r.a.createElement("div",{className:"ExitProjectPopupContent"},r.a.createElement("div",{className:"Message"},r.a.createElement(M.Scrollbars,{style:{width:"100%",height:300,fontSize:18}},Y.map(function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{cursor:"point"},key:e.username,className:se===e.username?"active Utitle":"Utitle"},"\u7528\u6237\uff1a",e.username,Oe===e.userId?r.a.createElement("div",null,r.a.createElement(Ht,{key:"editDir",isPassword:!1,onChange:_e}),r.a.createElement("span",{className:"confirmLabel",onClick:function(t){return a=e.userId,void ee("/mark/sign/addDir",{dir:Le,userId:a}).then(function(e){200===e.status&&(Ge(),Ee(""),Pe(""))});var a}},"\u786e\u5b9a"),r.a.createElement("span",{className:"confirmLabel delete",onClick:function(t){return e.userId,Ee(""),void Pe("")}},"\u53d6\u6d88")):r.a.createElement("span",{className:"ShowLabel",onClick:function(t){return a=e.userId,void Ee(a);var a}},"\u65b0\u5efa\u6587\u4ef6\u5939")),r.a.createElement("ul",null,e.list&&e.list.map(function(t,n){return r.a.createElement("li",{key:n},r.a.createElement("img",{src:a(205)}),r.a.createElement("span",{className:"DirName"},t),r.a.createElement("span",{className:"ShowLabel",onClick:function(e){return function(e,t){d(e),ee("/mark/sign/picList",{dir:t,pageNo:1,pageSize:100}).then(function(e){200===e.status&&re(e.data.rows)})}(e,t)}},"\u67e5\u770b"),r.a.createElement("span",{className:"ShowLabel ImportLabel",onClick:function(){return a=e.userId,fe({userId:a,dir:t}),void De.current.click();var a}},"\u5bfc\u5165"))})))})),r.a.createElement("input",{type:"file",style:{display:"none"},ref:De,accept:"image/*",onChange:function(e){return Se(e.target.files)},multiple:!0,hidden:!0})))}:function(){return r.a.createElement("div",{className:"ExitProjectPopupContent"},r.a.createElement("div",{className:"Message"},D?r.a.createElement(M.Scrollbars,{style:{width:"100%",height:300,fontSize:18}},U.map(function(e,t){return r.a.createElement("p",{style:{cursor:"point"},onClick:function(){return je(e)},key:e,className:se===e?"active":""},e)})):r.a.createElement(r.a.Fragment,null,"\u7528\u6237\u540d\uff1a ",r.a.createElement(Ht,{key:"username",isPassword:!1,onChange:ke}),"\u5bc6\u7801\uff1a ",r.a.createElement(Ht,{key:"password",isPassword:!0,onChange:Ne}))))},acceptLabel:D?"\u5f00\u59cb\u6807\u8bb0":"\u767b\u5f55",onAccept:D?function(){n(0),t(nt.OBJECT_DETECTION),c(u.INSERT_LABEL_NAMES)}:function(){ee("/mark/igt/login",{username:I,password:C}).then(function(e){200!==e.status?X.store.addNotification({title:"\u767b\u5f55\u51fa\u9519",message:e.message,type:"warning",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}}):(b("token",e.data),X.store.addNotification({message:"\u767b\u5f55\u6210\u529f",type:"success",insert:"top",container:"top-center",animationIn:["animated","fadeIn"],animationOut:["animated","fadeOut"],dismiss:{duration:1e3}}),te("/mark/sign/getDir").then(function(e){if(200===e.status){var t=e.data.reduce(function(e,t){return t.list?[].concat(Object(Ue.a)(e),Object(Ue.a)(t.list)):Object(Ue.a)(e)},[]);F(t)}}),k(!0))})},skipRejectButton:!D,rejectLabel:"\u9000\u51fa\u767b\u5f55",onReject:function(){y("token"),window.location.reload()},disableAcceptButton:D&&!se||D&&!ge,onClickUpload:Ge,onClickBack:function(){Re(),G(!1)},isUpload:j,isLogin:D}),p&&r.a.createElement(h,{className:"PicModal"},r.a.createElement("div",{className:"PicModal__Header"},"\u56fe\u7247\u5217\u8868"),r.a.createElement("div",{className:"PicModal__Content"},r.a.createElement(M.Scrollbars,{style:{width:"100%",height:300,fontSize:18,display:"flex",flexWrap:"wrap",justifyContent:"space-around"}},ie.map(function(e,t){return r.a.createElement("img",{style:{cursor:"point"},key:e.id,src:e.url})}))),r.a.createElement("div",{className:"PicModal__Footer"},r.a.createElement(Ct,{label:"\u8fd4\u56de",onClick:g,externalClassName:"back"}))),xe?r.a.createElement("div",{className:"Blocker"},r.a.createElement("div",null,r.a.createElement(aa.a,{type:"balls",color:"#fff",width:70}),r.a.createElement("p",null,"\u4e0a\u4f20\u4e2d..."),r.a.createElement("p",null,"Tips: \u4e0a\u4f20\u5927\u91cf\u56fe\u7247\u9700\u8981\u7b49\u5f85\u66f4\u957f\u65f6\u95f4."))):null)}),ra=function(){var e=Object(i.useState)(!1),t=Object(s.a)(e,2),a=t[0],n=t[1],o=Object(i.useState)(!1),c=Object(s.a)(o,2),l=c[0],u=c[1];qt()(function(e){return{tooltip:{backgroundColor:"#171717",color:"#ffffff",boxShadow:e.shadows[1],fontSize:11,maxWidth:120}}})(Zt.a);return r.a.createElement("div",{className:ce()("MainView",{InProgress:a,Canceled:!a&&l})},r.a.createElement("div",{className:"Slider",id:"lower"},r.a.createElement("div",{className:"TriangleVertical"},r.a.createElement("div",{className:"TriangleVerticalContent"}))),r.a.createElement("div",{className:"Slider",id:"upper"},r.a.createElement("div",{className:"TriangleVertical"},r.a.createElement("div",{className:"TriangleVerticalContent"}))),r.a.createElement("div",{className:"LeftColumn"},r.a.createElement("div",{className:"LogoWrapper"}),r.a.createElement("div",{className:"EditorFeaturesWrapper"},Jt.map(function(e){return r.a.createElement("div",{className:"EditorFeaturesTiles",key:e.displayText},r.a.createElement("div",{className:"EditorFeaturesTilesWrapper"},r.a.createElement("img",{draggable:!1,alt:e.imageAlt,src:e.imageSrc}),r.a.createElement("div",{className:"EditorFeatureLabel"},e.displayText)))})),r.a.createElement("div",{className:"TriangleVertical"},r.a.createElement("div",{className:"TriangleVerticalContent"})),a&&r.a.createElement(Ct,{label:"\u8fd4\u56de",onClick:function(){n(!1),u(!0)}})),r.a.createElement("div",{className:"RightColumn"},r.a.createElement("div",null),a&&r.a.createElement(ia,null),r.a.createElement("div",{className:"SocialMediaWrapper"}),r.a.createElement(Ct,{label:"\u5e38\u89c4\u6807\u8bb0",onClick:function(){window.location.href="https://uglyspoon.github.io/regular/"}}),!a&&r.a.createElement(Ct,{label:"\u5173\u8282\u6807\u8bb0",onClick:function(){n(!0)}})))},oa=(a(225),a(226),a(73));!function(e){e.IMAGE="image/jpeg, image/png",e.TEXT="text/plain"}(Rt||(Rt={}));var ca,sa={updateActiveLabelNameIndex:O,updateLabelNamesList:x,updateActivePopupType:be},la=Object(l.b)(function(e){return{}},sa)(function(e){var t=e.updateActiveLabelNameIndex,a=e.updateLabelNamesList,n=e.updateActivePopupType,o=Object(i.useState)([]),c=Object(s.a)(o,2),l=c[0],d=c[1],g=Object(i.useState)(!1),p=Object(s.a)(g,2),h=p[0],m=p[1],v=Object(oa.a)({accept:Rt.TEXT,multiple:!1,onDrop:function(e){1===e.length&&de.loadLabelsList(e[0],O,E)}}),f=v.acceptedFiles,b=v.getRootProps,y=v.getInputProps,O=function(e){d(e),m(!1)},E=function(){m(!0)};return r.a.createElement($t,{title:"\u5bfc\u5165\u6807\u7b7e\u5217\u8868\u6587\u4ef6",renderContent:function(){return r.a.createElement("div",{className:"LoadLabelsPopupContent"},r.a.createElement("div",{className:"Message"},"\u9009\u62e9\u4e00\u4e2a\u4f60\u51c6\u5907\u597d\u7684.txt\u683c\u5f0f\u7684\u6587\u672c\u6587\u4ef6\uff0c\u6ce8\u610f\u6bcf\u4e2a\u6807\u7b7e\u5e94\u8be5\u53e6\u8d77\u4e00\u884c"),r.a.createElement("div",b({className:"DropZone"}),h?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",y()),r.a.createElement("img",{draggable:!1,alt:"upload",src:"img/box-opened.png"}),r.a.createElement("p",{className:"extraBold"},"\u5bfc\u5165\u6587\u4ef6\u672a\u6210\u529f\uff01"),r.a.createElement("p",{className:"extraBold"},"\u8bf7\u518d\u8bd5\u4e00\u6b21")):0===f.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",y()),r.a.createElement("img",{draggable:!1,alt:"upload",src:"img/box-opened.png"}),r.a.createElement("p",{className:"extraBold"},"\u62d6\u62fd\u6587\u4ef6\u5230\u8fd9\u91cc"),r.a.createElement("p",null,"\u6216"),r.a.createElement("p",{className:"extraBold"},"\u70b9\u51fb\u6b64\u5904\u9009\u62e9\u5bfc\u5165")):1===l.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,alt:"uploaded",src:"img/box-closed.png"}),r.a.createElement("p",{className:"extraBold"},"\u5df2\u5bfc\u5165\u4e86\u4e00\u4e2a\u6807\u7b7e")):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,alt:"uploaded",src:"img/box-closed.png"}),r.a.createElement("p",{className:"extraBold"}," \u5df2\u5bfc\u5165\u4e86",l.length,"\u4e2a\u6807\u7b7e"))))},acceptLabel:"\u5f00\u59cb",onAccept:function(){l.length>0&&(t(0),a(l),et.close())},disableAcceptButton:0===l.length,rejectLabel:"\u8fd4\u56de",onReject:function(){n(u.INSERT_LABEL_NAMES)}})});a(227);!function(e){e.YOLO="YOLO",e.COCO="COCO",e.CSV="CSV",e.VOC="VOC",e.VGG_JSON="VGG_JSON",e.JSON="JSON"}(ca||(ca={}));var ua=a(95),da=a.n(ua),ga=a(32),pa=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"sanitize",value:function(e){return e.replace("<","&lt;").replace(">","&gt;").replace("&","&amp;").replace("'","&#39;").replace("/","&#x2F;")}}]),e}(),ha=a(137),ma=a.n(ha),va=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getExportFileName",value:function(){var e=we.getProjectName(),t=ma()().format("YYYYMMDDhhmmss");return"labels_".concat(e,"_").concat(t)}}]),e}(),fa=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"export",value:function(t){switch(t){case ca.YOLO:e.exportAsYOLO();break;case ca.VOC:e.exportAsVOC();break;case ca.CSV:e.exportAsCSV();break;default:return}}},{key:"exportAsYOLO",value:function(){var t=new da.a;we.getImagesData().forEach(function(a){var n=e.wrapRectLabelsIntoYOLO(a);if(n){var i=a.fileData.name.replace(/\.[^\/.]+$/,".txt");try{t.file(i,n)}catch(r){throw new Error(r)}}});try{t.generateAsync({type:"blob"}).then(function(e){Object(ga.saveAs)(e,"".concat(va.getExportFileName(),".zip"))})}catch(a){throw new Error(a)}}},{key:"wrapRectLabelsIntoYOLO",value:function(e){if(0===e.groupList[e.activeGroupIndex].labelRects.length||!e.loadStatus)return null;var t=ue.getById(e.id);return e.groupList[e.activeGroupIndex].labelRects.map(function(e){return[e.labelIndex+"",((e.rect.x+e.rect.width/2)/t.width).toFixed(6)+"",((e.rect.y+e.rect.height/2)/t.height).toFixed(6)+"",(e.rect.width/t.width).toFixed(6)+"",(e.rect.height/t.height).toFixed(6)+""].join(" ")}).join("\n")}},{key:"exportAsVOC",value:function(){var t=new da.a;we.getImagesData().forEach(function(a){var n=e.wrapImageIntoVOC(a);if(n){var i=a.fileData.name.replace(/\.[^\/.]+$/,".xml");try{t.file(i,n)}catch(r){throw new Error(r)}}});try{t.generateAsync({type:"blob"}).then(function(e){Object(ga.saveAs)(e,"".concat(va.getExportFileName(),".zip"))})}catch(a){throw new Error(a)}}},{key:"wrapRectLabelsIntoVOC",value:function(e){if(0===e.groupList[e.activeGroupIndex].labelRects.length||!e.loadStatus)return null;var t=we.getLabelNames();return e.groupList[e.activeGroupIndex].labelRects.map(function(e){return["\t<object>","\t\t<name>".concat(t[e.labelIndex],"</name>"),"\t\t<pose>Unspecified</pose>","\t\t<truncated>Unspecified</truncated>","\t\t<difficult>Unspecified</difficult>","\t\t<bndbox>","\t\t\t<xmin>".concat(Math.round(e.rect.x),"</xmin>"),"\t\t\t<ymin>".concat(Math.round(e.rect.y),"</ymin>"),"\t\t\t<xmax>".concat(Math.round(e.rect.x+e.rect.width),"</xmax>"),"\t\t\t<ymax>".concat(Math.round(e.rect.y+e.rect.height),"</ymax>"),"\t\t</bndbox>","\t</object>"].join("\n")}).join("\n")}},{key:"wrapImageIntoVOC",value:function(t){var a=e.wrapRectLabelsIntoVOC(t),n=pa.sanitize(we.getProjectName());if(a){var i=ue.getById(t.id);return["<annotation>","\t<folder>".concat(n,"</folder>"),"\t<filename>".concat(t.fileData.name,"</filename>"),"\t<path>/".concat(n,"/").concat(t.fileData.name,"</path>"),"\t<source>","\t\t<database>Unspecified</database>","\t</source>","\t<size>","\t\t<width>".concat(i.width,"</width>"),"\t\t<height>".concat(i.height,"</height>"),"\t\t<depth>3</depth>","\t</size>",a,"</annotation>"].join("\n")}return null}},{key:"exportAsCSV",value:function(){var t=we.getImagesData().map(function(t){return e.wrapRectLabelsIntoCSV(t)}).filter(function(e){return!!e}).join("\n"),a=new Blob([t],{type:"text/plain;charset=utf-8"});try{Object(ga.saveAs)(a,"".concat(va.getExportFileName(),".csv"))}catch(n){throw new Error(n)}}},{key:"wrapRectLabelsIntoCSV",value:function(e){if(0===e.groupList[e.activeGroupIndex].labelRects.length||!e.loadStatus)return null;var t=ue.getById(e.id),a=we.getLabelNames();return e.groupList[e.activeGroupIndex].labelRects.map(function(n){return[a[n.labelIndex],Math.round(n.rect.x)+"",Math.round(n.rect.y)+"",Math.round(n.rect.width)+"",Math.round(n.rect.height)+"",e.fileData.name,t.width+"",t.height+""].join(",")}).join("\n")}}]),e}(),ba=[{type:ca.JSON,label:"JSON\u683c\u5f0f\u6587\u4ef6"}],ya=[{type:ca.CSV,label:"\u5355\u4e00\u7684CSV\u6587\u4ef6"}],Oa=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"export",value:function(t){switch(t){case ca.CSV:e.exportAsCSV();break;default:return}}},{key:"exportAsCSV",value:function(){var t=we.getImagesData().map(function(t){return e.wrapRectLabelsIntoCSV(t)}).filter(function(e){return!!e}).join("\n"),a=new Blob([t],{type:"text/plain;charset=utf-8"});try{Object(ga.saveAs)(a,"".concat(va.getExportFileName(),".csv"))}catch(n){throw new Error(n)}}},{key:"wrapRectLabelsIntoCSV",value:function(e){if(0===e.groupList[e.activeGroupIndex].labelPoints.length||!e.loadStatus)return null;var t=ue.getById(e.id),a=we.getLabelNames();return e.groupList[e.activeGroupIndex].labelPoints.map(function(n){return[a[n.labelIndex],Math.round(n.point.x)+"",Math.round(n.point.y)+"",e.fileData.name,t.width+"",t.height+""].join(",")}).join("\n")}}]),e}(),Ea=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"export",value:function(t){switch(t){case ca.JSON:e.exportAsJson();break;default:return}}},{key:"exportAsJson",value:function(){var t=we.getImagesData(),a=we.getLabelNames(),n=JSON.stringify(e.mapImagesDataToVGGObject(t,a)),i=new Blob([n],{type:"text/plain;charset=utf-8"});try{Object(ga.saveAs)(i,"".concat(va.getExportFileName(),".json"))}catch(r){throw new Error(r)}}},{key:"mapImagesDataToVGGObject",value:function(t,a){return t.reduce(function(t,n){var i=e.mapImageDataToVGGFileData(n,a);return i&&(t[n.fileData.name]=i),t},{})}},{key:"mapImageDataToVGGFileData",value:function(t,a){var n=e.mapImageDataToVGG(t,a);if(!n)return null;var i=a,r=[];n.forEach(function(e){e=Object.values(e),i.forEach(function(t,a){e.some(function(e){return e.label===t})||e.push({label:t,type:"point",is_checked:null,all_points:null})});var t=e.sort(function(e,t){return i.indexOf(e.label)-i.indexOf(t.label)});r.push(t)});var o=r.map(function(e,t){var a=[];return e.forEach(function(e,t){e.all_points?a.push(e.all_points[0],e.all_points[1],e.is_checked):a.push(-1,-1,-1)}),{pose_keypoints_2d:a}});return{label_name:a,width:t.fileData.width,height:t.fileData.height,people:o}}},{key:"mapImageDataToVGG",value:function(t,a){if(!t.loadStatus||!t.groupList[t.activeGroupIndex].labelPoints||!t.groupList[t.activeGroupIndex].labelPoints.length||!a||!a.length)return null;var n=e.getValidPointLabelsArray(t),i=[];return n.length&&(i=n.map(function(e){return e.reduce(function(e,t,n){return e["".concat(n)]={all_points:[t.point.x,t.point.y],label:a[t.labelIndex],is_checked:t.checked?1:0,type:"point"},e},{})})),i}},{key:"getValidPolygonLabelsArray",value:function(e){return e.groupList.map(function(e){return e.labelPolygons.filter(function(e){return null!==e.labelIndex&&!!e.vertices.length})})}},{key:"getValidPointLabelsArray",value:function(e){return e.groupList.map(function(e){return e.labelPoints.filter(function(e){return null!==e.labelIndex&&!!e.point})})}},{key:"getValidPolygonLabels",value:function(e){return e.groupList[e.activeGroupIndex].labelPolygons.filter(function(e){return null!==e.labelIndex&&!!e.vertices.length})}},{key:"mapPolygonToVGG",value:function(e){return e&&e.length?e.map(function(e){return"(".concat(e.x,", ").concat(e.y,")")}).concat("(".concat(e[0].x,", ").concat(e[0].y,")")):null}}]),e}(),Ia=[{type:ca.VGG_JSON,label:"VGG JSON\u683c\u5f0f\u6587\u4ef6"}],Aa=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"export",value:function(t){switch(t){case ca.VGG_JSON:e.exportAsVGGJson();break;default:return}}},{key:"exportAsVGGJson",value:function(){var t=we.getImagesData(),a=we.getLabelNames(),n=JSON.stringify(e.mapImagesDataToVGGObject(t,a)),i=new Blob([n],{type:"text/plain;charset=utf-8"});try{Object(ga.saveAs)(i,"".concat(va.getExportFileName(),".json"))}catch(r){throw new Error(r)}}},{key:"mapImagesDataToVGGObject",value:function(t,a){return t.reduce(function(t,n){var i=e.mapImageDataToVGGFileData(n,a);return i&&(t[n.fileData.name]=i),t},{})}},{key:"mapImageDataToVGGFileData",value:function(t,a){var n=e.mapImageDataToVGG(t,a);return n?{fileref:"",size:t.fileData.size,filename:t.fileData.name,base64_img_data:"",file_attributes:{},regions:n}:null}},{key:"mapImageDataToVGG",value:function(t,a){if(!t.loadStatus||!t.groupList[t.activeGroupIndex].labelPolygons||!t.groupList[t.activeGroupIndex].labelPolygons.length||!a||!a.length)return null;var n=e.getValidPolygonLabels(t);return n.length?n.reduce(function(t,n,i){return t["".concat(i)]={shape_attributes:e.mapPolygonToVGG(n.vertices),region_attributes:{label:a[n.labelIndex]}},t},{}):null}},{key:"getValidPolygonLabels",value:function(e){return e.groupList[e.activeGroupIndex].labelPolygons.filter(function(e){return null!==e.labelIndex&&!!e.vertices.length})}},{key:"mapPolygonToVGG",value:function(e){return e&&e.length?{name:"polygon",all_points_x:e.map(function(e){return e.x}).concat(e[0].x),all_points_y:e.map(function(e){return e.y}).concat(e[0].y)}:null}}]),e}(),La=[{type:ca.YOLO,label:"YOLO \u683c\u5f0f\u7684zip\u5305"},{type:ca.VOC,label:"XML \u683c\u5f0f\u7684zip\u5305"},{type:ca.CSV,label:"\u5355\u4e00\u7684CSV\u6587\u4ef6"}],Pa=Object(l.b)(function(e){return{imagesData:e.editor.imagesData}},{})(function(){var e=Object(i.useState)(V.ALL),t=Object(s.a)(e,2),a=t[0],n=t[1],o=Object(i.useState)(null),c=Object(s.a)(o,2),l=c[0],u=c[1],d=function(e){return e.map(function(e){return r.a.createElement("div",{className:"OptionsItem",onClick:function(){return t=e.type,void u(t);var t},key:e.type},e.type===l?r.a.createElement("img",{draggable:!1,src:"ico/checkbox-checked.png",alt:"checked"}):r.a.createElement("img",{draggable:!1,src:"ico/checkbox-unchecked.png",alt:"unchecked"}),e.label)})};return r.a.createElement($t,{title:"\u5bfc\u51fa\u6807\u6ce8",renderContent:function(){return r.a.createElement("div",{className:"ExportLabelPopupContent"},r.a.createElement("div",{className:"LeftContainer"},r.a.createElement(lt,{image:"ico/all.png",imageAlt:"all",size:{width:40,height:40},padding:20,onClick:function(){n(V.ALL),u(null)},isActive:a===V.ALL})),r.a.createElement("div",{className:"RightContainer"},r.a.createElement("div",{className:"Message"},"\u9009\u62e9\u6807\u6ce8\u7c7b\u578b\u548c\u5bfc\u51fa\u6587\u4ef6\u683c\u5f0f"),r.a.createElement("div",{className:"Options"},a===V.ALL&&d(ba),a===V.RECTANGLE&&d(La),a===V.POINT&&d(ya),a===V.POLYGON&&d(Ia))))},acceptLabel:"\u5bfc\u51fa",onAccept:function(){if(l){switch(a){case V.RECTANGLE:fa.export(l);break;case V.POINT:Oa.export(l);break;case V.POLYGON:Aa.export(l);break;case V.ALL:Ea.export(l)}et.close()}},rejectLabel:"\u53d6\u6d88",onReject:function(){et.close()}})});a(267);function Ca(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ta(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ca(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ca(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var xa={updateActiveLabelNameIndex:O,updateLabelNamesList:x,updateActivePopupType:be},wa=Object(l.b)(function(e){return{}},xa)(function(e){e.updateActiveLabelNameIndex;var t=e.updateLabelNamesList,a=e.updateActivePopupType,n=Object(i.useState)({}),o=Object(s.a)(n,2),c=o[0],l=o[1],d=function(){var e=Ta({},c,Object(z.a)({},Z()(),""));l(e)},g=Object.keys(c).map(function(e){return r.a.createElement("div",{className:"LabelEntry",key:e},r.a.createElement(Ht,{key:e,isPassword:!1,onChange:function(t){return p(e,t.target.value)},label:"\u6807\u6ce8\u540d\u79f0"}),r.a.createElement(lt,{image:"ico/trash.png",imageAlt:"remove_label",size:{width:30,height:30},onClick:function(){return function(e){var t=Ta({},c);delete t[e],l(t)}(e)}}))}),p=function(e,t){var a=Ta({},c,Object(z.a)({},e,t));l(a)},h=function(){return Object.values(c).filter(function(e){return!!e})};return r.a.createElement($t,{title:"\u521b\u5efa\u6807\u7b7e\u5217\u8868",renderContent:function(){return r.a.createElement("div",{className:"InsertLabelNamesPopup"},r.a.createElement("div",{className:"LeftContainer"},r.a.createElement(lt,{image:"ico/plus.png",imageAlt:"plus",size:{width:40,height:40},padding:25,onClick:d})),r.a.createElement("div",{className:"RightContainer"},r.a.createElement("div",{className:"Message"},"\u5728\u4f60\u5f00\u59cb\u4e4b\u524d\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a\u5373\u5c06\u7528\u5728\u4f60\u9879\u76ee\u5185\u7684\u6807\u7b7e\u5217\u8868\uff0c\u70b9\u51fb\u5de6\u8fb9\u7684 + \u53f7\u6dfb\u52a0\u65b0\u6807\u7b7e"),r.a.createElement("div",{className:"LabelsContainer"},0!==Object.keys(c).length?r.a.createElement(G.a,null,r.a.createElement("div",{className:"InsertLabelNamesPopupContent"},g)):r.a.createElement("div",{className:"EmptyList",onClick:d},r.a.createElement("img",{draggable:!1,alt:"upload",src:"img/type-writer.png"}),r.a.createElement("p",{className:"extraBold"},"\u5f53\u524d\u9879\u76ee\u6807\u7b7e\u5217\u8868\u4e3a\u7a7a")))))},acceptLabel:"\u5f00\u59cb\u6807\u6ce8",onAccept:function(){var e=h();e.length>0&&(t(e),et.close())},disableAcceptButton:0===h().length,rejectLabel:"\u4ece\u6587\u4ef6\u8f7d\u5165",onReject:function(){a(u.LOAD_LABEL_NAMES)}})}),Da=(a(268),{updateActiveLabelNameIndex:O,updateLabelNamesList:x,updateProjectType:b,updateActiveImageIndex:y,updateImageData:T,updateFirstLabelCreatedFlag:w}),ka=Object(l.b)(function(e){return{}},Da)(function(e){var t=e.updateActiveLabelNameIndex,a=e.updateLabelNamesList,n=e.updateProjectType,i=e.updateActiveImageIndex,o=e.updateImageData,c=e.updateFirstLabelCreatedFlag;return r.a.createElement($t,{title:"Exit project",renderContent:function(){return r.a.createElement("div",{className:"ExitProjectPopupContent"},r.a.createElement("div",{className:"Message"},"Are you sure you want to leave the editor? You will permanently lose all your progress."))},acceptLabel:"Exit",onAccept:function(){t(null),a([]),n(null),i(null),o([]),c(!1),et.close()},rejectLabel:"Back",onReject:function(){et.close()}})}),Na=(a(269),{addImageData:C}),Ra=Object(l.b)(function(e){return{}},Na)(function(e){var t=e.addImageData,a=Object(i.useCallback)(function(e){e.forEach(function(e){var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){var a=new Image;a.src=t.result,a.onload=function(t){e.width=this.width,e.height=this.height}},t.readAsDataURL(e)})},[]),n=Object(oa.a)({accept:Rt.IMAGE,onDrop:a}),o=n.acceptedFiles,c=n.getRootProps,s=n.getInputProps;return r.a.createElement($t,{title:"\u5bfc\u5165\u66f4\u591a\u56fe\u7247",renderContent:function(){return r.a.createElement("div",{className:"LoadMoreImagesPopupContent"},r.a.createElement("div",c({className:"DropZone"}),0===o.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",s()),r.a.createElement("img",{draggable:!1,alt:"upload",src:"img/box-opened.png"}),r.a.createElement("p",{className:"extraBold"},"\u62d6\u62fd\u5230\u8fd9\u91cc"),r.a.createElement("p",null,"\u6216"),r.a.createElement("p",{className:"extraBold"},"\u70b9\u51fb\u5bfc\u5165")):1===o.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,alt:"uploaded",src:"img/box-closed.png"}),r.a.createElement("p",{className:"extraBold"},"\u5bfc\u5165\u4e86 1 \u5f20\u65b0\u56fe\u7247 ")):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{draggable:!1,key:1,alt:"uploaded",src:"img/box-closed.png"}),r.a.createElement("p",{key:2,className:"extraBold"},"\u5bfc\u5165\u4e86 ",o.length," \u5f20\u65b0\u56fe\u7247"))))},acceptLabel:"\u8f7d\u5165",disableAcceptButton:o.length<1,onAccept:function(){o.length>0&&(t(o.map(function(e){return de.mapFileDataToImageData(e)})),et.close())},rejectLabel:"\u53d6\u6d88",onReject:function(){et.close()}})}),Sa=Object(l.b)(function(e){return{activePopupType:e.general.activePopupType}})(function(e){var t=e.activePopupType;return t&&r.a.createElement("div",{className:"PopupView"},function(){switch(t){case u.LOAD_LABEL_NAMES:return r.a.createElement(la,null);case u.EXPORT_LABELS:return r.a.createElement(Pa,null);case u.INSERT_LABEL_NAMES:return r.a.createElement(wa,null);case u.EXIT_PROJECT:return r.a.createElement(ka,null);case u.LOAD_IMAGES:return r.a.createElement(Ra,null);default:return null}}())}),_a=(a(270),Object(l.b)(function(e){return{size:e.general.windowSize}},{})(function(e){var t=e.size,a=Object(i.useState)(0),n=Object(s.a)(a,2),o=n[0],c=n[1],l=function(e){return e.map(function(e){return r.a.createElement("div",{className:"EditorFeaturesTiles",key:e.displayText},r.a.createElement("div",{className:"EditorFeaturesTilesWrapper"},r.a.createElement("img",{draggable:!1,alt:e.imageAlt,src:e.imageSrc}),r.a.createElement("div",{className:"EditorFeatureLabel"},e.displayText)))})},u=r.a.createElement("div",{className:ce()("MobileTopNavigationBar",{Hide:o<350,Show:o>=350})},r.a.createElement("div",{className:"NavigationBarGroupWrapper"},r.a.createElement("div",{className:"Header"},r.a.createElement("img",{draggable:!1,alt:"make-sense",src:"/make-sense-ico-transparent.png"}),"Make Sense")),r.a.createElement("div",{className:"TriangleHorizontal Bottom"},r.a.createElement("div",{className:"TriangleHorizontalContent"}))),d=r.a.createElement("div",{className:"FirstStage"},r.a.createElement("img",{draggable:!1,alt:"main-logo",src:"img/main-image-color.png"}),r.a.createElement("div",{className:"TriangleHorizontal Bottom"},r.a.createElement("div",{className:"TriangleHorizontalContent"}))),g=r.a.createElement("div",{className:"SecondStage"},l(Jt.slice(0,3))),p=r.a.createElement("div",{className:"ThirdStage"},l(Jt.slice(3,6)),r.a.createElement("div",{className:"TriangleHorizontal Top"},r.a.createElement("div",{className:"TriangleHorizontalContent"})),r.a.createElement("div",{className:"TriangleHorizontal Bottom"},r.a.createElement("div",{className:"TriangleHorizontalContent"}))),h=r.a.createElement("div",{className:"FourthStage"},r.a.createElement("div",{className:"Message"},"Due to the small size of the screen we do not support our editor on mobile devices. Check what you missed and visit us from a desktop."),r.a.createElement("div",{className:"SocialMediaWrapper"},function(e){return Yt.map(function(t,a){return r.a.createElement(lt,{key:a,size:e,image:t.imageSrc,imageAlt:t.imageAlt,href:t.href})})}({width:40,height:40})));return r.a.createElement("div",{className:"MobileMainView"},u,r.a.createElement(G.a,{onScrollFrame:function(e){c(e.scrollTop)}},r.a.createElement("div",{className:"MobileMainViewContent",style:{width:t.width}},d,g,p,h)))})),ja=(a(271),function(){return r.a.createElement("div",{className:"SizeItUpView"},r.a.createElement("p",{className:"extraBold"},"Ops... This window is to tight for me!"),r.a.createElement("img",{draggable:!1,alt:"small_window",src:"img/small_window.png"}),r.a.createElement("p",{className:"extraBold"},"Please... make it at least ",g.EDITOR_MIN_WIDTH," x ",g.EDITOR_MIN_HEIGHT," px."))}),Ma=Object(l.b)(function(e){return{projectType:e.editor.projectType,windowSize:e.general.windowSize}})(function(e){var t=e.projectType,a=e.windowSize;return r.a.createElement("div",{className:"App"},Ke.mobileDeviceData.manufacturer&&Ke.mobileDeviceData.os?r.a.createElement(_a,null):t?a.height<g.EDITOR_MIN_HEIGHT||a.width<g.EDITOR_MIN_WIDTH?r.a.createElement(ja,null):r.a.createElement(Xt,null):r.a.createElement(ra,null),r.a.createElement(Sa,null),r.a.createElement(Y.a,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ga=a(49),Ba={activeImageIndex:0,projectName:"regular_project",imagesData:[],projectType:null,labelNames:[]};function za(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ua(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?za(a,!0).forEach(function(t){Object(z.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):za(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Fa={windowSize:null,activePopupType:null,customCursorStyle:Ae.DEFAULT,activeContext:null};var Ha=Object(Ga.b)({general:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.UPDATE_WINDOW_SIZE:return Ua({},e,{windowSize:t.payload.windowSize});case p.UPDATE_ACTIVE_POPUP_TYPE:return Ua({},e,{activePopupType:t.payload.activePopupType});case p.UPDATE_CUSTOM_CURSOR_STYLE:return Ua({},e,{customCursorStyle:t.payload.customCursorStyle});case p.UPDATE_CONTEXT:return Ua({},e,{activeContext:t.payload.activeContext});default:return e}},editor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ba,t=arguments.length>1?arguments[1]:void 0,a=e.activeImageIndex,n=e.imagesData[a]?e.imagesData[a].activeGroupIndex:void 0;return Object(Se.a)(e,function(i){switch(t.type){case p.UPDATE_PROJECT_TYPE:i.projectType=t.payload.projectType;break;case p.UPDATE_PROJECT_NAME:i.projectName=t.payload.projectName;break;case p.UPDATE_ACTIVE_IMAGE_INDEX:i.activeImageIndex=t.payload.activeImageIndex;break;case p.UPDATE_ACTIVE_LABEL_NAME_INDEX:i.imagesData[a].groupList[n].activeLabelNameIndex=t.payload.activeLabelNameIndex;break;case p.UPDATE_LABEL_INDEX_BY_INFO:var r=t.payload,o=r.imageIndex,c=r.groupIndex,s=r.labelPointIndex,l=r.labelIndex,u=r.labelCheckd;if(!i.imagesData[o].groupList[c].labelPoints[s])break;i.imagesData[o].groupList[c].labelPoints[s].labelIndex=l,i.imagesData[o].groupList[c].labelPoints[s].checked=u;break;case p.UPDATE_ACTIVE_LABEL_ID:i.imagesData[a].groupList[n].activeLabelId=t.payload.activeLabelId;break;case p.UPDATE_HIGHLIGHTED_LABEL_ID:i.imagesData[a].groupList[n].highlightedLabelId=t.payload.highlightedLabelId;break;case p.UPDATE_ACTIVE_LABEL_TYPE:i.imagesData[a].groupList[n].activeLabelType=t.payload.activeLabelType;break;case p.UPDATE_IMAGE_DATA_BY_ID:i.imagesData=e.imagesData.map(function(e){return e.id===t.payload.id?t.payload.newImageData:e});break;case p.ADD_IMAGES_DATA:var d=t.payload.imageData;t.payload.inital?i.imagesData=d:i.imagesData=i.imagesData.concat(d);break;case p.LOAD_DATA_FROM_LOCALSTORGE:i.imagesData.forEach(function(e,t){if(localStorage.getItem(e.fileData.name)){var a=JSON.parse(localStorage.getItem(e.fileData.name));a.fileData=i.imagesData[t].fileData,i.imagesData[t]=a}});break;case p.UPDATE_IMAGES_DATA:i.imagesData=t.payload.imageData;break;case p.UPDATE_LABEL_NAMES_LIST:i.labelNames=t.payload.labelNames;break;case p.UPDATE_FIRST_LABEL_CREATED_FLAG:i.imagesData[a].groupList[n].firstLabelCreatedFlag=t.payload.firstLabelCreatedFlag;break;case p.UPDATE_GROUP_LIST:i.imagesData[a].groupList.push({activeLabelNameIndex:0,activeLabelType:V.POINT,activeLabelId:null,highlightedLabelId:null,firstLabelCreatedFlag:!1,labelRects:[],labelPoints:[],labelPolygons:[]});break;case p.DELETE_GROUP_LIST:var g=i.imagesData[a].groupList.filter(function(e,a){return a!==t.payload.groupIndex}),h=i.imagesData[a].groupList[n],m=g.findIndex(function(e){return e===h});i.imagesData[a].activeGroupIndex=m,i.imagesData[a].groupList=g;break;case p.UPDATE_ACTIVE_GROUP_INDEX:i.imagesData[a].activeGroupIndex=t.payload.groupIndex;break;case p.FIND_NEXT_AVAILABLE_LABEL_INDEX:var v=Object(Ue.a)(Array(i.labelNames.length)).map(function(e,t){return t}),f=i.imagesData[a].groupList[n].labelPoints.map(function(e){return e.labelIndex}),b=f.concat(v).filter(function(e){return!f.includes(e)||!v.includes(e)});i.imagesData[a].groupList[n].activeLabelNameIndex=b.length?b[0]:0}})}});var Va=a(138),Wa=a.n(Va),Xa=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"getMobileDeviceData",value:function(e){var t=new Wa.a(e);return{manufacturer:t.mobile(),browser:t.userAgent(),os:t.os()}}},{key:"isMac",value:function(e){return!!e.toLowerCase().match("mac")}},{key:"isSafari",value:function(e){return!!e.toLowerCase().match("safari")}},{key:"isFirefox",value:function(e){return!!e.toLowerCase().match("firefox")}}]),e}(),Ya=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"inti",value:function(){e.handleResize(),e.detectDeviceParams(),window.addEventListener("resize",e.handleResize),at.init()}}]),e}();Ya.handleResize=function(){var e;Ja.dispatch((e={width:window.innerWidth,height:window.innerHeight},{type:p.UPDATE_WINDOW_SIZE,payload:{windowSize:e}}))},Ya.detectDeviceParams=function(){var e=window.navigator.userAgent;Ke.mobileDeviceData=Xa.getMobileDeviceData(e),Ke.isMac=Xa.isMac(e),Ke.isSafari=Xa.isSafari(e),Ke.isFirefox=Xa.isFirefox(e)},a.d(t,"store",function(){return Ja});var Ja=Object(Ga.c)(Ha);Ya.inti(),c.a.render(r.a.createElement(l.a,{store:Ja},r.a.createElement(Ma,null)),document.getElementById("root")||document.createElement("div")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[141,1,2]]]);
//# sourceMappingURL=main.5a62228d.chunk.js.map